<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>የፋሲል ዌብ - መግቢያ</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background-color: #f4f4f4; color: #333; }
        .container { background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); max-width: 400px; margin: 0 auto; }
        h2 { text-align: center; color: #3498db; }
        input[type="email"], input[type="password"], input[type="text"] {
            width: 90%; padding: 10px; margin: 10px 0; border: 1px solid #ccc; border-radius: 4px; display: block;
        }
        button {
            background-color: #3498db; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer;
            width: 100%; margin-top: 10px;
        }
        button:hover { background-color: #2980b9; }
        .toggle-btn { background-color: #2ecc71; }
        .error { color: red; text-align: center; margin-top: 10px; }
        .success { color: green; text-align: center; margin-top: 10px; }

        /* Dashboard Styles */
        #dashboard { display: none; text-align: center; }
        #dashboard h3 { color: #2ecc71; }
        #logout-btn { background-color: #e74c3c; width: 50%; margin: 20px auto; display: block; }
    </style>
</head>
<body>

    <div class="container" id="auth-container">
        <h2>ፋሲል ዌብ</h2>
        <h3 id="auth-title">መመዝገብ (Sign Up)</h3>
        <p class="error" id="error-message"></p>

        <input type="email" id="email" placeholder="ኢሜይል" required>
        <input type="password" id="password" placeholder="የይለፍ ቃል (ቢያንስ 6)" required>
        <input type="text" id="phone" placeholder="ስልክ ቁጥር" required>

        <button id="auth-btn">ይመዝገቡ (Sign Up)</button>
        <button id="toggle-auth" class="toggle-btn">የመግቢያ ገጽ (Switch to Login)</button>
    </div>

    <div class="container" id="dashboard">
        <h3>እንኳን ደህና መጡ!</h3>
        <p>በተሳካ ሁኔታ ገብተዋል (Logged In)!</p>
        <p>የእርስዎ ኢሜይል: <span id="user-email"></span></p>
        <p>የስልክ ቁጥርዎ: <span id="user-phone"></span></p>
        <button id="logout-btn">ውጣ (Log Out)</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebase/9/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebase/9/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebase/9/firebase-firestore.js";

        // የእርስዎ Config Code እዚህ ተተክቷል
        const firebaseConfig = {
            apiKey: "AIzaSyBfAZlPdTPjIxrnl3bi3rPu3oq9M4plWc",
            authDomain: "fasilweb.firebaseapp.com",
            projectId: "fasilweb",
            storageBucket: "fasilweb.firebasestorage.app",
            messagingSenderId: "647418971286",
            appId: "1:647418971286:web:d23d7848362e15ced62eb7",
            measurementId: "G-KDFZWQHE00"
        };

        // Firebaseን ማስጀመር
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // የ HTML ክፍሎችን መምረጥ
        const authContainer = document.getElementById('auth-container');
        const dashboard = document.getElementById('dashboard');
        const authTitle = document.getElementById('auth-title');
        const authBtn = document.getElementById('auth-btn');
        const toggleAuth = document.getElementById('toggle-auth');
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');
        const phoneInput = document.getElementById('phone');
        const errorMessage = document.getElementById('error-message');
        const logoutBtn = document.getElementById('logout-btn');
        const userEmailSpan = document.getElementById('user-email');
        const userPhoneSpan = document.getElementById('user-phone');

        let isSignUp = true;

        // የ Authentication ገጽ መቀያየሪያ
        toggleAuth.addEventListener('click', () => {
            isSignUp = !isSignUp;
            if (isSignUp) {
                authTitle.textContent = 'መመዝገብ (Sign Up)';
                authBtn.textContent = 'ይመዝገቡ (Sign Up)';
                toggleAuth.textContent = 'የመግቢያ ገጽ (Switch to Login)';
                phoneInput.style.display = 'block';
            } else {
                authTitle.textContent = 'መግባት (Log In)';
                authBtn.textContent = 'ግባ (Log In)';
                toggleAuth.textContent = 'የምዝገባ ገጽ (Switch to Sign Up)';
                phoneInput.style.display = 'none';
            }
            errorMessage.textContent = '';
        });

        // ስህተቶችን መቆጣጠር
        function handleError(error) {
            const errorCode = error.code;
            let message = "ያልታወቀ ስህተት ተፈጥሯል!";

            if (errorCode === 'auth/weak-password') {
                message = "የይለፍ ቃልዎ በጣም ደካማ ነው (ቢያንስ 6 ቁምፊዎች ይሞክሩ)።";
            } else if (errorCode === 'auth/email-already-in-use') {
                message = "ይህ ኢሜይል ቀደም ብሎ ተመዝግቧል።";
            } else if (errorCode === 'auth/invalid-email') {
                message = "ትክክለኛ ያልሆነ ኢሜይል አስገብተዋል።";
            } else if (errorCode === 'auth/user-not-found' || errorCode === 'auth/wrong-password') {
                message = "የተጠቃሚ ስም ወይም የይለፍ ቃል ትክክል አይደለም።";
            } else {
                 message = error.message;
            }

            errorMessage.textContent = message;
        }

        // መመዝገብ እና መግባት
        authBtn.addEventListener('click', async () => {
            const email = emailInput.value;
            const password = passwordInput.value;
            const phone = phoneInput.value;
            errorMessage.textContent = '';

            if (isSignUp) {
                // የምዝገባ ሂደት
                if (!phone) {
                    errorMessage.textContent = "እባክዎ ስልክ ቁጥር ያስገቡ።";
                    return;
                }
                try {
                    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                    const user = userCredential.user;

                    // የመለያ መረጃ ወደ Firestore ማስቀመጥ
                    await setDoc(doc(db, "users", user.uid), {
                        phone: phone,
                        plan: "Free", // ነባሪው ፕላን
                        createdAt: new Date()
                    });

                    errorMessage.textContent = "✅ በተሳካ ሁኔታ ተመዝግበዋል! እየገቡ ነው...";

                } catch (error) {
                    handleError(error);
                }
            } else {
                // የመግቢያ ሂደት
                try {
                    await signInWithEmailAndPassword(auth, email, password);
                    errorMessage.textContent = "✅ በተሳካ ሁኔታ ገብተዋል!";
                } catch (error) {
                    handleError(error);
                }
            }
        });

        // መውጣት
        logoutBtn.addEventListener('click', async () => {
            try {
                await signOut(auth);
            } catch (error) {
                console.error("Error signing out:", error);
            }
        });

        // የተጠቃሚ ሁኔታ መከታተል (ገብቷል/አልገባም)
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                // ተጠቃሚ ከገባ
                authContainer.style.display = 'none';
                dashboard.style.display = 'block';
                userEmailSpan.textContent = user.email;

                // የተጠቃሚውን ስልክ ቁጥር ከ Firestore መሳብ
                try {
                    const docRef = doc(db, "users", user.uid);
                    const docSnap = await getDoc(docRef);

                    if (docSnap.exists()) {
                        userPhoneSpan.textContent = docSnap.data().phone || "አልተገኘም";
                    } else {
                        userPhoneSpan.textContent = "መረጃ አልተገኘም";
                    }
                } catch (error) {
                    console.error("Error fetching user data:", error);
                    userPhoneSpan.textContent = "ስህተት ተፈጥሯል";
                }

            } else {
                // ተጠቃሚ ካልገባ
                dashboard.style.display = 'none';
                authContainer.style.display = 'block';
            }
        });

    </script>
</body>
</html>
