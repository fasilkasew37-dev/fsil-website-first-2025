·àà·àò<!DOCTYPE html>
<html lang="am">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>·çã·à≤·àç ·ãå·â• ·ä†·çï - Fasil Web App (Final Version)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* --- General CSS (Original Logic Maintained) --- */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            text-align: center; padding: 0; margin: 0;
            background-color: #f0f4f8; color: #333;
            padding-bottom: 90px;
        }
        .container { max-width: 700px; margin: 0 auto; padding: 5px; }
        
        /* Header Logic */
        .top-header {
            display: flex; justify-content: space-between; align-items: center;
            background: #fff; padding: 5px 10px; border-bottom: 3px solid #007bff;
        }
        .header-icon-img { width: 45px; height: 45px; border-radius: 50%; object-fit: cover; object-position: top; border: 2px solid #ccc; }
        .marquee-container-top { flex: 1; overflow: hidden; white-space: nowrap; margin: 0 10px; }
        .marquee-text-top { display: inline-block; padding-left: 100%; animation: marquee 15s linear infinite; color: #007bff; font-weight: bold; font-size: 16px; }
        
        /* Footer Logic */
        .footer-wrapper { position: fixed; bottom: 0; left: 0; width: 100%; z-index: 1000; background: white; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); }
        .bottom-nav { display: flex; height: 55px; width: 100%; }
        .nav-btn { flex: 1; border: none; font-weight: bold; font-size: 14px; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; }
        .nav-home { background-color: #28a745; } 
        .nav-live { background-color: #ffc107; color: black; } 
        .nav-profile { background-color: #dc3545; }
        
        .bottom-marquee { background: #f0f0f0; color: #28a745; font-weight: bold; overflow: hidden; white-space: nowrap; height: 25px; line-height: 25px; font-size: 12px; }
        .bottom-marquee span { display: inline-block; padding-left: 100%; animation: marquee 12s linear infinite; }
        @keyframes marquee { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }

        /* Sections Handling */
        .section { display: none; background: white; padding: 15px; border-radius: 8px; margin-top: 10px; min-height: 400px; }
        .show { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity:0; } to { opacity:1; } }

        /* Welcome Split - Compacted */
        .split-container { display: flex; justify-content: space-between; gap: 5px; text-align: left; margin-bottom: 5px; }
        .split-left { width: 48%; color: #007bff; font-size: 10px; line-height: 1.2; padding: 2px; }
        .split-right { width: 48%; color: #d35400; font-size: 10px; font-weight: bold; line-height: 1.2; border-left: 1px solid #ccc; padding-left: 5px; padding: 2px; }
        .blue-spacer { height: 10px; background-color: #007bff; margin: 5px 0; border-radius: 5px; }

        /* --- COMPLEX LOGO AREA (Eagle, Dove & Ring) --- */
        .brand-area { display: flex; align-items: center; justify-content: space-between; margin-top: 15px; padding: 0 5px; }
        
        /* Side Logos: Blue Circle Border */
        .side-logo { 
            width: 65px; 
            height: 65px; 
            object-fit: cover; 
            border-radius: 50%; 
            border: 3px solid #007bff; 
            padding: 2px;
            background: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        /* Central Complex Logo Construction */
        .complex-logo { 
            position: relative; 
            width: 120px; 
            height: 120px; 
            margin: 0 auto; 
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .main-ring {
            position: absolute;
            width: 110px;
            height: 110px;
            border: 5px solid #007bff;
            border-radius: 50%;
            z-index: 1;
        }
        .fwa-center-text {
            font-size: 24px;
            font-weight: 900;
            z-index: 2;
            color: #333;
        }
    </style>
</head>
/* --- PART 2: RING LOGO & DASHBOARD CSS --- */
        .ring { position: absolute; border-radius: 50%; display: flex; align-items: center; justify-content: center; top: 50%; left: 50%; transform: translate(-50%, -50%); }
        
        /* Blue Outer Ring */
        .ring-blue { width: 110px; height: 110px; border: 4px solid #00008b; background: transparent; z-index: 1; }
        
        /* Red Ring */
        .ring-red { width: 92px; height: 92px; border: 3px solid red; z-index: 2; }
        
        /* Items on Red/Yellow Ring (Positioning Logic) */
        .pos-item { position: absolute; width: 16px; height: 16px; object-fit: cover; border-radius: 50%; border: 1px solid rgba(255,255,255,0.7); }
        .p-n { top: -8px; left: 50%; transform: translateX(-50%); } 
        .p-s { bottom: -8px; left: 50%; transform: translateX(-50%); } 
        .p-e { right: -8px; top: 50%; transform: translateY(-50%); } 
        .p-w { left: -8px; top: 50%; transform: translateY(-50%); } 
        .p-ne { top: 12%; right: 12%; } .p-nw { top: 12%; left: 12%; }
        .p-se { bottom: 12%; right: 12%; } .p-sw { bottom: 12%; left: 12%; }

        /* Yellow Ring */
        .ring-yellow { width: 70px; height: 70px; border: 3px solid yellow; z-index: 3; }
        
        /* Green Center (Lion Container) */
        .ring-green { width: 52px; height: 52px; background: green; border-radius: 50%; z-index: 4; position: relative; overflow: hidden; }
        
        /* Flashing Animation Behind Dove */
        .flash-light { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle, white, #007bff); opacity: 0.5; animation: flash 1s infinite alternate; z-index: 5; }
        @keyframes flash { from { opacity: 0.3; } to { opacity: 0.8; } }
        
        .center-dove { position: absolute; width: 40px; height: 40px; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 6; opacity: 0.6; }
        
        /* Central Lion (Bigger & Clearer) */
        .center-lion { 
            position: absolute; 
            width: 50px; 
            height: 50px; 
            top: 50%; left: 50%; 
            transform: translate(-50%, -50%); 
            z-index: 7; 
            object-fit: cover; 
            border-radius: 50%; 
            border: 1px solid white; 
        }

        /* General Images */
        .lion-full-img { width: 100%; height: auto; max-height: 200px; object-fit: contain; margin-top: 10px; border-radius: 8px; }
        .eagle-dash-img { width: 50px; height: 50px; object-fit: cover; border-radius: 50%; vertical-align: middle; margin-right: 10px; }

        /* Dashboard Split Logic */
        .dash-layout { display: flex; gap: 10px; align-items: flex-start; }
        .dash-left { width: 60%; text-align: left; } .dash-right { width: 40%; }
        
        /* UI Buttons & Elements (Maintaining your color logic) */
        input, select, textarea { width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; margin: 5px 0; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; color: white; }
        .btn-green { background: #28a745; } 
        .btn-red { background: #dc3545; } 
        .btn-blue { background: #007bff; } 
        .btn-yellow { background: #ffc107; color: black; }
        .btn-small { padding: 8px; font-size: 12px; margin: 2px 0; }
        .btn-tiny { padding: 5px; font-size: 10px; margin: 1px; }
        .btn-admin { background: #333; color: white; display: none; }
        .lang-btn { background: #6c757d; color: white; padding: 4px 8px; font-size: 10px; border-radius: 4px; border:none; cursor: pointer; margin-top: 2px; }
        
        /* Compact UI elements */
        .btn-compact { padding: 8px; margin: 2px 0; font-size: 14px; margin-top: 15px; }

        /* Modal Overlays */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: none; justify-content: center; align-items: center; z-index: 2000; }
    </style>
<div class="brand-area">
            <img src="eagle_image.jpg" class="side-logo" alt="Eagle">

            <div class="complex-logo">
                <div class="ring ring-blue"></div>
                
                <div class="ring ring-red">
                    <img src="item1.jpg" class="pos-item p-n">
                    <img src="item2.jpg" class="pos-item p-ne">
                    <img src="item3.jpg" class="pos-item p-e">
                    <img src="item4.jpg" class="pos-item p-se">
                    <img src="item5.jpg" class="pos-item p-s">
                    <img src="item6.jpg" class="pos-item p-sw">
                    <img src="item7.jpg" class="pos-item p-w">
                    <img src="item8.jpg" class="pos-item p-nw">
                </div>

                <div class="ring ring-yellow"></div>

                <div class="ring ring-green">
                    <div class="flash-light"></div>
                    <img src="dove_image.jpg" class="center-dove" alt="Dove">
                    <img src="lion_image.jpg" class="center-lion" alt="Lion">
                </div>
            </div>

            <img src="dove_image.jpg" class="side-logo" alt="Dove">
        </div>

        <h2 style="margin: 10px 0; color: #007bff; font-size: 28px;">
            <span style="color: green;">F</span><span style="color: orange;">W</span><span style="color: red;">A</span>
        </h2>
<div class="modal-overlay" id="adm-prem-modal">
            <div class="modal-box">
                <h3>Premium Payment Receiver</h3>
                <button class="btn-blue" onclick="alert('PayPal/Intl Payment Gateway Open')">1. International (PayPal)</button>
                <button class="btn-green" onclick="alert('Local Method 1 Gateway Open')">2. Local Bank 1</button>
                <button class="btn-green" onclick="alert('Local Method 2 Gateway Open')">3. Local Bank 2</button>
                <button class="btn-red" onclick="document.getElementById('adm-prem-modal').style.display='none'">Close</button>
            </div>
        </div>

        <div class="modal-overlay" id="comment-type-modal">
            <div class="modal-box">
                <h3 id="t-com-act">Action</h3>
                <button class="btn-blue" onclick="openComSub('give')">Give Comment</button>
                <button class="btn-blue" onclick="openComSub('view')">View Comments</button>
                <button class="btn-red" onclick="document.getElementById('comment-type-modal').style.display='none'">Cancel</button>
            </div>
        </div>

        <div class="modal-overlay" id="comment-media-modal">
            <div class="modal-box">
                <h3 id="t-com-media">Select Type</h3>
                <button class="btn-blue" onclick="processComment('text')">Text</button>
                <button class="btn-blue" onclick="processComment('image')">Image</button>
                <button class="btn-blue" onclick="processComment('video')">Video</button>
                <button class="btn-blue" onclick="processComment('audio')">Voice</button>
                <button class="btn-red" onclick="document.getElementById('comment-media-modal').style.display='none'">Cancel</button>
            </div>
        </div>

        <div class="modal-overlay" id="view-comments-list-modal">
            <div class="modal-box">
                <h3>Comments</h3>
                <div id="comments-display-area" style="text-align:left; max-height:300px; overflow-y:auto;"></div>
                <button class="btn-red" onclick="document.getElementById('view-comments-list-modal').style.display='none'">Close</button>
            </div>
        </div>

        <div class="modal-overlay" id="share-modal">
            <div class="modal-box">
                <h3>Share To</h3>
                <button class="btn-blue" onclick="shareTo('telegram')">Telegram</button>
                <button class="btn-blue" onclick="shareTo('facebook')">Facebook</button>
                <button class="btn-blue" onclick="shareTo('tiktok')">TikTok</button>
                <button class="btn-blue" onclick="shareTo('youtube')">YouTube</button>
                <button class="btn-red" onclick="closeShare()">Close</button>
            </div>
        </div>

        <div class="modal-overlay" id="admin-login-modal">
            <div class="modal-box">
                <h3>Admin Login</h3>
                <input type="password" id="admin-pass-in" placeholder="Code (abc123456abd)">
                <button class="btn-green" onclick="adminLogin()">Enter</button>
                <button class="btn-red" onclick="document.getElementById('admin-login-modal').style.display='none'">Cancel</button>
            </div>
        </div>

        <div class="modal-overlay" id="receipt-modal">
            <div class="modal-box">
                <h3>Payment Receipt</h3>
                <p>Receipt Uploaded Successfully.</p>
                <div id="receipt-actions">
                    <button class="btn-blue" onclick="downloadReceipt()">Save Receipt to Phone</button>
                    <button class="btn-green" onclick="closeReceiptModal()">Receive Receipt (OK)</button>
                </div>
            </div>
        </div>

        <div id="view-agreement" class="section show">
            <div id="welcome-content">
                <div class="split-container">
                    <div class="split-left">
                        <h4 id="t-w-s">·ä•·äï·ä≥·äï ·ã∞·àÖ·äì ·àò·å°</h4>
<p id="t-in">·ã≠·àÖ ·ã®·çã·à≤·àç ·ãå·â• ·ä†·çï ·â†·â∞·ä†·àõ·äí·äê·âµ ·ä•·äï·ã≤·à∞·à´ ·ã®·â∞·âÄ·ã®·à∞ ·ã≤·åÇ·â≥·àç ·àò·à®·åÉ ·àò·åã·à™·ã´ ·äê·ãç·ç¢ ·àÅ·àå·àù ·âµ·ä≠·ä≠·àà·äõ ·àò·à®·åÉ·ãé·âΩ·äï ·ã´·âÄ·à≠·â£·àç·ç¢</p>
    </div>
    <div class="split-right">
        <h4 id="t-p-s">·å•·â•·âÖ ·àò·àò·à™·ã´</h4>
        <p id="t-po">·çñ·àà·â≤·ä´·ç£ ·å•·àã·âª·ç£ ·ãò·à®·äù·äê·âµ ·ä•·äì ·àÄ·à∞·â∞·äõ ·àò·à®·åÉ ·àõ·âÖ·à®·â• ·â†·å•·â•·âÖ ·ã®·â∞·ä®·àà·ä®·àà ·äê·ãç·ç¢</p>
    </div>
</div>

<div style="display: flex; gap: 10px; margin-top: 5px; justify-content: center;">
    <button class="btn-green btn-tiny" onclick="handleAgree()" id="btn-agree">·ä•·àµ·àõ·àõ·àà·àÅ</button>
    <button class="btn-red btn-tiny" onclick="showAlert('·ä†·àç·â∞·àµ·àõ·àô·àù', 'error')" id="btn-disagree">·ä†·àç·àµ·àõ·àõ·àù</button>
</div>

<div class="blue-spacer"></div>

<div class="brand-area">
    <img src="eagle_image.jpg" class="side-logo" alt="Eagle">
    
    <div class="complex-logo">
        <div class="ring ring-blue">
            <div class="ring ring-red">
                <img src="lion_image.jpg" class="pos-item p-n" alt="L">
                <img src="lion_image.jpg" class="pos-item p-s" alt="L">
                <img src="lion_image.jpg" class="pos-item p-e" alt="L">
                <img src="lion_image.jpg" class="pos-item p-w" alt="L">
                <img src="dove_image.jpg" class="pos-item p-ne" alt="D">
                <img src="dove_image.jpg" class="pos-item p-nw" alt="D">
                <img src="dove_image.jpg" class="pos-item p-se" alt="D">
                <img src="dove_image.jpg" class="pos-item p-sw" alt="D">
                
                <div class="ring ring-yellow">
                    <img src="eagle_image.jpg" class="pos-item p-n" alt="E">
                    <img src="eagle_image.jpg" class="pos-item p-s" alt="E">
                    <img src="eagle_image.jpg" class="pos-item p-e" alt="E">
                    <img src="eagle_image.jpg" class="pos-item p-w" alt="E">
                    
                    <div class="ring ring-green">
                        <div class="flash-light"></div>
                        <img src="dove_image.jpg" class="center-dove" alt="Dove">
                        <img src="lion_image.jpg" class="center-lion" alt="Center Lion">
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <img src="dove_image.jpg" class="side-logo" alt="Dove">
</div>

<div id="auth-section" style="display:none;">
    <p style="color: green; font-weight: bold; font-size: 14px; margin-top:15px;" id="t-thx">
        ·ä†·åà·àç·åç·àé·â≥·âΩ·äï·äï ·àµ·àà·àò·à®·å° ·ä•·äì·àò·à∞·åç·äì·àà·äï! ·ä†·ã≤·àµ ·ä®·àÜ·äë ·ã≠·àò·ãù·åà·â°·ç£ ·ä´·àà·ãé·âµ ·ã≠·åç·â°·ç¢
    </p>
    <div style="display:flex; gap:10px; margin-top:10px;">
        <button class="btn-red" onclick="showAuth('signup')" id="btn-sh-s">·àò·àò·ãù·åà·â¢·ã´</button>
        <button class="btn-red" onclick="showAuth('login')" id="btn-sh-l">·àò·åç·â¢·ã´</button>
    </div>
</div>
<div id="form-signup" style="display:none; margin-top:10px; border: 1px solid #dc3545; padding: 10px; border-radius: 5px;">
            <div id="signup-step-1">
                <h3 style="color:#dc3545;" id="h-s">·àù·ãù·åà·â£ (·ä†·ã≤·àµ ·â•·âª)</h3>
                <input type="text" id="reg-name" placeholder="Full Name">
                <input type="text" id="reg-phone" placeholder="Phone (09... 10 digits)">
                <input type="email" id="reg-email" placeholder="Email (@gmail.com only)">
                <input type="password" id="reg-pass" placeholder="Password (6 digits)">
                <button class="btn-green" onclick="preSignup()">Submit</button>
            </div>
            <div id="signup-step-2" style="display:none;">
                <h3>Upload Profile Photo</h3>
                <button class="btn-blue" onclick="promptUpload('profile')">Upload Photo</button>
                <input type="file" id="file-profile" class="hidden-input" accept="image/*">
                <button class="btn-green" onclick="finalSignup()">Complete Registration</button>
            </div>
        </div>

        <div id="form-login" style="display:none; margin-top:10px; border: 1px solid #dc3545; padding: 10px; border-radius: 5px;">
            <h3 style="color:#dc3545;" id="h-l">·àò·åç·â¢·ã´ (·äê·â£·à≠)</h3>
            <input type="text" id="log-phone" placeholder="Phone">
            <input type="password" id="log-pass" placeholder="Password">
            <button class="btn-blue" onclick="doLogin()">Login</button>
        </div>

        <div id="view-home" class="section">
            <div style="display:flex; align-items:center; border-bottom:1px solid #ddd; padding-bottom:5px;">
                <img src="eagle_image.jpg" class="eagle-dash-img">
                <h2 id="t-d" style="margin:0;">·ã≥·àΩ·â¶·à≠·ãµ</h2>
            </div>
            
            <div class="dash-layout" style="margin-top:10px;">
                <div class="dash-left">
                    <button class="btn-green" style="border-radius: 0;" id="btn-fc" onclick="toggleList('free')">·ã®·äê·çÉ ·ä†·åà·àç·åç·àé·âµ ·àõ·ãï·ä®·àç</button>
                    <div id="list-free" style="display:none; padding-left: 10px;">
                        <button class="btn-green btn-small" onclick="navTo('view-info')" id="btn-lv">·àò·à®·åÉ ·àò·àò·àç·ä®·âµ</button>
                        <button class="btn-green btn-small" onclick="navTo('post-info')" id="btn-lp">·àò·à®·åÉ ·àò·àà·å†·çç</button>
                        <button class="btn-green btn-small" onclick="handleGroupCreate()" id="btn-lg">·åç·à©·çï ·àò·çç·å†·à≠</button>
                        <button class="btn-green btn-small" onclick="showMyGroups()" id="btn-lmg">·ã®·çà·å†·à©·âµ·äï ·åç·à©·çï ·àà·àò·àò·àç·ä®·âµ</button>
                        <button class="btn-green btn-small" onclick="handleChatList()" id="btn-lc">·âª·âµ</button>
                        <button class="btn-green btn-small" onclick="navTo('feedback-sec')" id="btn-lf">·àà·çã·à≤·àç ·ãå·â• ·ä†·çï ·çà·å£·à™ ·ä†·àµ·â∞·ã´·ã®·âµ ·àà·àò·àµ·å†·âµ ·ä•·äì ·àà·àò·àò·àç·ä®·âµ</button>
                        <button class="btn-green btn-small" onclick="showUserList(false)" id="btn-lu">·â∞·å†·âÉ·àö·ãé·âΩ</button>
                        <button class="btn-green btn-small" onclick="checkAuth('business-sec')" id="btn-lb">·â¢·ãù·äê·àµ</button>
                        <button class="btn-green btn-small" style="background-color:#333;" onclick="checkAuth('report-inbox')" id="btn-admin-rep">·à™·çñ·à≠·âµ ·àò·âÄ·â†·ã´ (Admin)</button>
                    </div>

                    <button class="btn-yellow" style="border-radius: 0; margin-top: 10px;" id="btn-pc" onclick="toggleList('prem')">·ã®·ä≠·çç·ã´ ·çï·à™·àö·ã®·àù ·ä†·åà·àç·åç·àé·âµ</button>
                    <div id="list-prem" style="display:none; padding-left: 10px;">
<button class="btn-yellow btn-small" onclick="navTo('view-info'); alert('Premium Video Feed (High Quality)')">·å•·à´·âµ ·ã´·àà·ãç ·â™·ã≤·ãÆ</button>
                        <button class="btn-yellow btn-small" onclick="navTo('view-info'); alert('Premium News Feed')">·ãú·äì (High Quality)</button>
                        <button class="btn-yellow btn-small" onclick="navTo('view-info'); alert('Premium Image Feed')">·àù·àµ·àç (High Quality)</button>
                        <button class="btn-yellow btn-small" onclick="openPrem('ppt')" id="btn-pp">PowerPoint</button>
                        <button class="btn-yellow btn-small" onclick="openPrem('pdf')" id="btn-ppdf">PDF</button>
                    </div>
                </div>
                <div class="dash-right"><img src="lion_image.jpg" class="lion-full-img"></div>
            </div>
            <button class="btn-red" style="margin-top:20px;" onclick="doLogout()" id="btn-out">·ãç·å£</button>
        </div>

        <div id="post-info" class="section">
            <h3 id="t-ph">·àò·à®·åÉ ·àò·àà·å†·çç</h3>
            <div id="post-type-select">
                <button class="btn-blue" onclick="setupPost('text')" id="btn-pt">üìù Text</button>
                <button class="btn-blue" onclick="setupPost('image')" id="btn-pi">üì∑ Image</button>
                <button class="btn-blue" onclick="setupPost('video')" id="btn-pv">üé• Video</button>
                <button class="btn-blue" onclick="setupPost('audio')" id="btn-pa">üéôÔ∏è Audio</button>
            </div>
            
            <div id="post-form-area" style="display:none; border-top:1px solid #ccc; margin-top:10px; padding-top:10px;">
                <p id="post-instr" style="color:blue; font-size:12px;"></p>
                <div style="display:flex; gap:5px;">
                     <input type="text" id="p-title" placeholder="Title (Required)">
                     <button class="btn-red btn-tiny" onclick="clearPostForm()">·ä†·çÖ·ã≥ (Clear)</button>
                </div>
                <textarea id="p-content" placeholder="Details (Text Only)..." style="display:none;"></textarea>
                <input type="file" id="file-post" class="hidden-input">
                <button class="btn-green" onclick="submitPost()" id="btn-pnow">Post Now</button>
            </div>
            <button class="btn-red btn-small" onclick="goBack()" id="btn-bk1">Back</button>
        </div>

        <div id="view-info" class="section">
            <h3 id="t-vh">·àò·à®·åÉ ·àò·àò·àç·ä®·âµ</h3>
            <div style="display:flex; gap:5px;">
                <button class="btn-blue btn-small" onclick="renderPosts('text')" id="btn-vt">Text</button>
                <button class="btn-blue btn-small" onclick="renderPosts('image')" id="btn-vi">Image</button>
                <button class="btn-blue btn-small" onclick="renderPosts('video')" id="btn-vv">Video</button>
                <button class="btn-blue btn-small" onclick="renderPosts('audio')" id="btn-va">Audio</button>
            </div>
            <div id="feed-container" style="margin-top:10px;"></div>
            <button class="btn-red btn-small" onclick="goBack()" id="btn-bk2">Back</button>
        </div>

        <div id="report-inbox" class="section">
            <h3>·à™·çñ·à≠·âµ ·àò·âÄ·â†·ã´ (Admin)</h3>
            <div style="margin-bottom:10px; display:flex; flex-direction:column; gap:5px;">
                <button class="btn-blue btn-small" onclick="promptAdminAction('changePass')">1. Change Admin Pass</button>
                <button class="btn-blue btn-small" onclick="promptAdminAction('userStats')">2. User Activity Monitor</button>
                <button class="btn-green btn-small" onclick="promptAdminAction('premPay')">3. Premium Payment Receiver</button>
<button class="btn-red btn-small" onclick="promptAdminAction('viewRep')">4. Receive Reports (Ban/Unban)</button>
            </div>
            <div id="admin-dynamic-content" style="text-align:left; margin-top:10px;"></div>
            <button class="btn-red btn-small" onclick="goBack()">Back</button>
        </div>

        <div id="business-sec" class="section">
            <h3 id="t-bh">·â¢·ãù·äê·àµ ·àõ·ãï·ä®·àç</h3>
            <div style="background:#f9f9f9; padding:10px; border:1px solid #ddd;">
                <p>USD: <b id="bal-usd">0.00</b> | GBP: <b id="bal-gbp" style="color:red;">0.00</b> | EUR: <b id="bal-eur" style="color:blue;">0.00</b></p>
                <p>ETB: <b id="bal-etb" style="color:green;">0.00</b></p>
                <hr>
                <p style="color:green; font-weight:bold;">Total (USD): <span id="bal-total">0.00</span></p>
                <p style="color:red; font-weight:bold;">Total (ETB): <span id="bal-total-etb">0.00</span></p>
            </div>
            <button class="btn-green" onclick="navTo('deposit-sec')" id="btn-bd">Deposit</button>
            <button class="btn-blue" onclick="navTo('withdraw-sec')" id="btn-bw">Withdraw</button>
            <button class="btn-yellow" onclick="navTo('intl-sec')" id="btn-bi">International Purchase</button>
            <button class="btn-red btn-small" onclick="goBack()" id="btn-bk3">Back</button>
        </div>

        <div id="deposit-sec" class="section">
            <h3 id="t-dep-h">Deposit</h3>
            <div id="dep-step-1">
                <input type="number" id="dep-amt" placeholder="Amount (ETB)">
                <select id="dep-cur">
                    <option value="ETB">ETB</option>
                    <option value="USD">USD</option>
                    <option value="GBP">GBP</option>
                    <option value="EUR">EUR</option>
                </select>
                <button class="btn-green" onclick="preDeposit()">Submit</button>
            </div>
            <div id="dep-step-2" class="hidden">
                <button class="btn-blue" onclick="promptUpload('deposit')">Upload Receipt</button>
                <input type="file" id="file-deposit" class="hidden-input">
            </div>
            <button class="btn-red btn-small" onclick="goBack()" id="btn-bk4">Back</button>
        </div>

        <div id="withdraw-sec" class="section">
            <h3 id="t-with-h">Withdraw</h3>
            <select id="w-cur">
                <option value="USD">From USD</option>
                <option value="GBP">From GBP</option>
                <option value="EUR">From EUR</option>
                <option value="ETB">From ETB</option>
            </select>
            <select id="w-method" onchange="toggleReceiverInput()">
                <option value="Telebirr">Telebirr</option>
                <option value="CBE">CBE</option>
                <option value="PayPal">PayPal</option>
            </select>
            <input type="text" id="w-dest" placeholder="Phone/Account" style="display:none; margin-bottom: 2px; font-size: 13px;">
            <input type="number" id="w-amt" placeholder="Amount">
            
            <button class="btn-compact btn-blue" onclick="reqWithdraw()" id="btn-sub-with">Withdraw</button>
            <button class="btn-compact btn-red" onclick="goBack()" id="btn-bk5">Back</button>
        </div>

        <div id="intl-sec" class="section">
            <h3 id="t-intl-h">International Purchase</h3>
            <button class="btn-blue" onclick="document.getElementById('intl-list').style.display='block'">·àù·à®·å• (Select)</button>
            <div id="intl-list" class="hidden" style="margin-top:10px;">
                <p>Select Service to Pay:</p>
                <div style="display:flex; flex-direction:column; gap:5px;">
                    <button class="btn-blue btn-small" onclick="triggerIntlPay('ChatGPT')">1. ChatGPT</button>
<button class="btn-blue btn-small" onclick="triggerIntlPay('Amazon')">2. Amazon</button>
                    <button class="btn-blue btn-small" onclick="triggerIntlPay('Hosting')">3. Hosting</button>
                    <button class="btn-blue btn-small" onclick="triggerIntlPay('Domain')">4. Domain</button>
                    <button class="btn-blue btn-small" onclick="triggerIntlPay('Netflix')">5. Netflix</button>
                </div>
                <input type="file" id="file-intl" class="hidden-input">
            </div>
            <button class="btn-red btn-small" onclick="goBack()" id="btn-bk6">Back</button>
        </div>

        <div id="prem-pricing" class="section">
            <h3 id="t-pay-h">Payment</h3>
            <button class="btn-green" onclick="pay(5)">Daily (5 ETB)</button>
            <button class="btn-green" onclick="pay(25)">Weekly (25 ETB)</button>
            <button class="btn-green" onclick="pay(30)">Monthly (30 ETB)</button>
            <div id="pay-up-area" style="display:none;">
                <button class="btn-blue" onclick="promptUpload('pay')">Upload Receipt</button>
                <input type="file" id="file-pay" class="hidden-input">
                <button class="btn-green" onclick="finPay()">Confirm</button>
            </div>
            <button class="btn-red btn-small" onclick="goBack()" id="btn-bk7">Back</button>
        </div>

        <div id="feedback-sec" class="section">
            <h3 id="t-fh">Feedback</h3>
            <p id="t-fb-sub">·àà·çã·à≤·àç ·ãå·â• ·ä†·çï ·çà·å£·à™ ·ä†·àµ·â∞·ã´·ã®·âµ ·àà·àò·àµ·å†·âµ</p>
            <button class="btn-blue" onclick="giveFb('text')" id="btn-fb-txt">Text</button>
            <button class="btn-yellow" onclick="openLiveCamera()" id="btn-fb-live">Live</button>
            <hr>
            <button class="btn-blue" onclick="viewFbs()" id="btn-view-fb">View Feedbacks</button>
            <div id="fb-list"></div>
            <button class="btn-red btn-small" onclick="goBack()" id="btn-bk8">Back</button>
        </div>

        <div id="chat-sec" class="section">
            <h3 id="t-chat-h">Chat</h3>
            <div id="chat-box" style="height:200px; overflow-y:auto; border:1px solid #ddd; margin-bottom:5px;"></div>
            <input type="text" id="chat-in" placeholder="Message">
            <div style="display:flex; gap:5px; margin-top:5px;">
                <button class="btn-blue btn-small" onclick="sendChat('text')">Send</button>
                <button class="btn-yellow btn-small" onclick="promptUpload('chat-img')">üì∑</button>
                <button class="btn-yellow btn-small" onclick="promptUpload('chat-vid')">üé•</button>
                <button class="btn-yellow btn-small" onclick="promptUpload('chat-aud')">üéôÔ∏è</button>
                <button class="btn-red btn-small" onclick="openLiveCamera()">üî¥</button>
            </div>
            <input type="file" id="file-chat" class="hidden-input">
            <button class="btn-red btn-small" onclick="goBack()" id="btn-bk9">Back</button>
        </div>

        <div id="user-list-sec" class="section">
            <h3 id="t-users-h">Users</h3>
            <div id="ul-cont"></div>
            <button class="btn-green" id="btn-grp-done" style="display:none;" onclick="createGroup()">Done (5+)</button>
            <button class="btn-red btn-small" onclick="goBack()" id="btn-bk10">Back</button>
        </div>

        <div id="my-groups-sec" class="section">
            <h3 id="t-mygrp-h">My Groups</h3>
            <div id="grp-list"></div>
            <button class="btn-red btn-small" onclick="goBack()" id="btn-bk11">Back</button>
        </div>

        <div id="view-live" class="section">
            <h2 id="t-live">·âÄ·å•·â≥ ·àµ·à≠·å≠·âµ (Live)</h2>
            <video id="live-video-element" autoplay playsinline></video>
            <button class="btn-red" onclick="stopLive()">Stop Live</button>
        </div>
<div id="view-profile" class="section">
            <h2 id="t-prof">·ã®·åç·àç ·àõ·ãï·ä®·àç</h2>
            <div style="text-align:left;">
                <p>Phone: <b id="prof-phone"></b> (Disabled)</p>
                <h4 id="t-edit-prof">Edit Profile</h4>
                <input type="text" id="prof-name-edit" placeholder="Name">
                <input type="password" id="old-pass" placeholder="Old Password">
                <input type="password" id="new-pass" placeholder="New Password">
                <input type="password" id="conf-pass" placeholder="Confirm Password">
                <button class="btn-blue" onclick="promptUpload('profile-edit')" id="btn-chg-pic">Change Photo</button>
                <input type="file" id="file-profile-edit" class="hidden-input" accept="image/*">
                <button class="btn-green" onclick="saveProfile()" id="btn-up-prof">Update</button>
            </div>
            <button class="btn-red" style="margin-top:10px;" onclick="doLogout()" id="btn-prof-out">Logout</button>
        </div>
    </div> <input type="file" id="comment-file-input" class="hidden-input">
    <input type="file" id="universal-file" class="hidden-input">

    <div class="footer-wrapper">
        <div class="bottom-nav">
            <button class="nav-btn nav-home" onclick="navTab('home')"><i class="fas fa-home"></i> <span id="nav-h">Home</span></button>
            <button class="nav-btn nav-live" onclick="navTab('live')"><i class="fas fa-broadcast-tower"></i> <span id="nav-l">Live</span></button>
            <button class="nav-btn nav-profile" onclick="navTab('profile')"><i class="fas fa-user"></i> <span id="nav-p">Profile</span></button>
        </div>
        <div class="bottom-marquee">
            <span>·çã·à≤·àç ·ãå·â• ·ä†·çï - Fasil Web App (Service Center)</span>
        </div>
    </div>

    <script>
        // --- CORE DATA (LOCAL STORAGE LOGIC PRESERVED) ---
        let user = JSON.parse(localStorage.getItem('fg_user')) || null;
        let users = JSON.parse(localStorage.getItem('fg_users')) || [];
        let posts = JSON.parse(localStorage.getItem('fg_posts')) || [];
        let groups = JSON.parse(localStorage.getItem('fg_groups')) || [];
        let chats = JSON.parse(localStorage.getItem('fg_chats')) || {};
        let feedbacks = JSON.parse(localStorage.getItem('fg_fbs')) || [];
        let reports = JSON.parse(localStorage.getItem('fg_reports')) || [];
        let adminPass = localStorage.getItem('fg_admin_pass') || 'abc123456abc'; 
        
        let lang = 'am';
        let hasAgreed = false;
        let viewHistory = [];
        let activePostType = 'text';
        let activeChat = null;
        let activeCommentPostId = null;
        let pendingAct = null;
        let uploadTarget = '';
        let liveStream = null;
        let comMode = 'view'; 
        let pendingAdminAction = null; 
        let lastReceiptUrl = '';

        const RATES = {USD:120, GBP:150, EUR:130};

        // --- TRANSLATIONS (Strict 100% Original Content) ---
        const TXT = {
            'am': {
                'head-txt':'·ä•·äï·ä≥·äï ·ãà·ã∞ ·çã·à≤·àç ·ãå·â• ·ä†·çï ·ã®·ä†·åà·àç·åç·àé·âµ ·àõ·ãï·ä®·àç ·â†·ã∞·àÖ·äì ·àò·å°!', 
                'lang-btn-txt':'·ä•·äï·åç·àä·ãù·äõ (English)',
                't-w-s':'·ä•·äï·ä≥·äï ·ã∞·àÖ·äì ·àò·å°', 
                't-in':'·ã≠·àÖ ·ã®·çã·à≤·àç ·ãå·â• ·ä†·çï ·â†·â∞·ä†·àõ·äí·äê·âµ ·ä•·äï·ã≤·à∞·à´ ·ã®·â∞·âÄ·ã®·à∞ ·ã≤·åÇ·â≥·àç ·àò·à®·åÉ ·àò·åã·à™·ã´ ·äê·ãç·ç¢ ·àÅ·àå·àù ·âµ·ä≠·ä≠·àà·äõ ·àò·à®·åÉ·ãé·âΩ·äï ·ã´·âÄ·à≠·â£·àç·ç¢ ·ä•·ãç·äê·â∞·äõ ·àò·à®·åÉ·ãà·âΩ·äï ·àò·àò·àç·ä®·âµ ·ä•·äì ·àò·åã·à´·âµ ·ã≠·âΩ·àã·àâ ·â†·â∞·å®·àõ·à™·àù ·àå·àé·âΩ ·ã®·çì·ãà·à≠ ·çñ·ã≠·äï·âµ ·ã®·â¢·ãù·äê·àµ ·ä•·äì ·çí·ã≤·ä§·çç ·ä†·åà·àç·åç·àé·â∂·âΩ·äï ·ã´·åà·äõ·àâ ·ä•·äì·àò·à∞·åç·äì·àà·äï·ç¢',
                't-p-s':'·å•·â•·âÖ ·àò·àò·à™·ã´', 
                't-po':'·çñ·àà·â≤·ä´·ç£ ·å•·àã·âª·ç£ ·ãò·à®·äù·äê·âµ ·ä•·äì ·àÄ·à∞·â∞·äõ ·àò·à®·åÉ ·àõ·âÖ·à®·â• ·â†·å•·â•·âÖ ·ã®·â∞·ä®·àà·ä®·àà ·äê·ãç·ç¢ ·çñ·àä·à≤·ã´·âΩ·äï ·å•·à∞·ãç ·ä®·â∞·åà·äô ·â†·å•·â•·âÖ ·ã®·à≤·àµ·â∞·àù ·âÅ·å•·å•·à´·âΩ·äï ·ä•·äì ·â†·å•·â•·âÖ ·à≤·àµ·â∞·àõ·âΩ·äï ·â†·à´·àµ ·à∞·à≠ ·ä®·ä†·åà·àç·åç·àé·â≥·âΩ·äï ·à≤·àµ·â∞·àù ·àä·ã´·åç·ãµ·ãà·âµ ·ã≠·âΩ·àã·àç·ç¢',
                'btn-agree':'·ä•·àµ·àõ·àõ·àà·àÅ', 
                'btn-disagree':'·ä†·àç·àµ·àõ·àõ·àù',
                't-thx':'·ä†·åà·àç·åç·àé·â≥·âΩ·äï·äï ·àµ·àà·àò·à®·å° ·ä•·äì·àò·à∞·åç·äì·àà·äï! ·ä†·ã≤·àµ ·ä®·àÜ·äë ·ã≠·àò·ãù·åà·â°·ç£ ·ä´·àà·ãé·âµ ·ã≠·åç·â°·ç¢',
                'btn-sh-s':'·àò·àò·ãù·åà·â¢·ã´', 
                'btn-sh-l':'·àò·åç·â¢·ã´', 
                'h-s':'·àù·ãù·åà·â£', 
                'h-l':'·àò·åç·â¢·ã´',
// --- PART 12: COMPLETE DICTIONARY (AM & EN) ---
                't-d':'·ã≥·àΩ·â¶·à≠·ãµ', 'btn-fc':'·ã®·äê·çÉ ·ä†·åà·àç·åç·àé·âµ ·àõ·ãï·ä®·àç', 'btn-pc':'·ã®·ä≠·çç·ã´ ·çï·à™·àö·ã®·àù ·ä†·åà·àç·åç·àé·âµ', 'btn-out':'·ãç·å£', 
                'btn-lv':'·àò·à®·åÉ ·àò·àò·àç·ä®·âµ', 'btn-lp':'·àò·à®·åÉ ·àò·àà·å†·çç', 'btn-lg':'·åç·à©·çï ·àò·çç·å†·à≠', 'btn-lmg':'·ã®·çà·å†·à©·âµ·äï ·åç·à©·çï',
                'btn-lc':'·âª·âµ', 'btn-lf':'·àà·çã·à≤·àç ·ãå·â• ·ä†·çï ·çà·å£·à™ ·ä†·àµ·â∞·ã´·ã®·âµ ·àà·àò·àµ·å†·âµ ·ä•·äì ·àà·àò·àò·àç·ä®·âµ', 'btn-lu':'·â∞·å†·âÉ·àö·ãé·âΩ', 'btn-lb':'·â¢·ãù·äê·àµ', 'btn-admin-rep':'·à™·çñ·à≠·âµ ·àò·âÄ·â†·ã´ (Admin)',
                'btn-pv':'·å•·à´·âµ ·â™·ã≤·ãÆ', 'btn-pn':'·ãú·äì', 'btn-pp':'PowerPoint', 'btn-ppdf':'PDF',
                't-ph':'·àò·à®·åÉ ·àò·àà·å†·çç', 't-vh':'·àò·à®·åÉ ·àò·àò·àç·ä®·âµ', 't-bh':'·â¢·ãù·äê·àµ ·àõ·ãï·ä®·àç', 't-dep-h':'·åà·äï·ãò·â• ·àõ·àµ·åà·â£·âµ',
                't-with-h':'·åà·äï·ãò·â• ·àõ·ãç·å£·âµ', 't-intl-h':'·ãì·àà·àù ·ä†·âÄ·çç ·åç·ã¢', 't-pay-h':'·ä≠·çç·ã´', 't-fb-h':'·ä†·àµ·â∞·ã´·ã®·âµ',
                't-chat-h':'·âª·âµ', 't-users-h':'·â∞·å†·âÉ·àö·ãé·âΩ', 't-mygrp-h':'·åç·à©·çñ·âΩ', 't-live':'·âÄ·å•·â≥ ·àµ·à≠·å≠·âµ', 't-prof':'·ã®·åç·àç ·àõ·ãï·ä®·àç',
                'nav-h':'·ãã·äì', 'nav-l':'·àã·ã≠·â≠', 'nav-p':'·çï·àÆ·çã·ã≠·àç', 'btn-back-1':'·â∞·àò·àà·àµ', 'btn-select':'·àù·à®·å•',
                'btn-p-txt':'üìù ·çÖ·àÅ·çç', 'btn-p-img':'üì∑ ·àù·àµ·àç', 'btn-p-vid':'üé• ·â™·ã≤·ãÆ', 'btn-p-aud':'üéôÔ∏è ·ãµ·àù·çÖ',
                'btn-v-txt':'·çÖ·àÅ·çç', 'btn-v-img':'·àù·àµ·àç', 'btn-v-vid':'·â™·ã≤·ãÆ', 'btn-v-aud':'·ãµ·àù·çÖ',
                'btn-post-now':'·àà·å•·çç', 'btn-dep':'·åà·äï·ãò·â• ·ä†·àµ·åà·â£', 'btn-with':'·åà·äï·ãò·â• ·ä†·ãç·å£', 'btn-intl':'·ä†·àà·àù ·ä†·âÄ·çç ·åç·ã¢',
                't-edit-prof':'·çï·àÆ·çã·ã≠·àç ·àò·âÄ·ã®·à≠', 'btn-chg-pic':'·çé·â∂ ·âÄ·ã≠·à≠', 'btn-up-prof':'·ä†·ãò·àù·äï (Update)', 'btn-prof-out':'·ãç·å£',
                't-fb-sub':'·àà·ä†·ãµ·àö·äï (Text / Live)', 'btn-fb-txt':'·â†·çÖ·àÅ·çç', 'btn-fb-live':'·àã·ã≠·â≠', 'btn-view-fb':'·ä†·àµ·â∞·ã´·ã®·âµ ·ã≠·àò·àç·ä®·â±',
                't-choose-com':'·äÆ·àò·äï·âµ ·ä†·ã≠·äê·âµ ·ã≠·àù·à®·å°', 't-post-instr':'·ä†·â£·ä≠·ãé ·àò·à®·åÉ·ãç·äï ·ã≠·çÉ·çâ', 't-com-act':'·ä†·àõ·à´·å≠', 't-com-media':'·ä†·ã≠·äê·âµ ·ã≠·àù·à®·å°'
            },
            'en': {
                'head-txt':'Welcome to Fasil Web App Service Center!', 'lang-btn-txt':'Amharic (·ä†·àõ·à≠·äõ)',
                't-w-s':'Welcome', 't-in':'Fasil Web App is a reliable digital sharing platform. You can share real information and access PPT/PDF services.',
                't-p-s':'Strict Policy', 't-po':'Political conflict, hatred, racism, and fake news are strictly prohibited. Violators will be automatically banned by our AI system.',
                'btn-agree':'I Agree', 'btn-disagree':'Disagree',
                't-thx':'Thank you! Register or Login.', 'btn-sh-s':'Signup', 'btn-sh-l':'Login', 'h-s':'Register', 'h-l':'Login',
                't-d':'Dashboard', 'btn-fc':'Free Services', 'btn-pc':'Premium Services', 'btn-out':'Logout',
                'btn-lv':'View Info', 'btn-lp':'Post Info', 'btn-lg':'Create Group', 'btn-lmg':'My Groups',
                'btn-lc':'Chat', 'btn-lf':'Feedback to Creator', 'btn-lu':'Users', 'btn-lb':'Business', 'btn-admin-rep':'Report Inbox',
                'btn-pv':'HD Video', 'btn-pn':'News', 'btn-pp':'PPT', 'btn-ppdf':'PDF',
                't-ph':'Post Info', 't-vh':'View Info', 't-bh':'Business Center', 't-dep-h':'Deposit',
                't-with-h':'Withdraw', 't-intl-h':'Intl Purchase', 't-pay-h':'Payment', 't-fb-h':'Feedback',
                't-chat-h':'Chat', 't-users-h':'Users', 't-mygrp-h':'My Groups', 't-live':'Live Stream', 't-prof':'Profile',
                'nav-h':'Home', 'nav-l':'Live', 'nav-p':'Profile', 'btn-back-1':'Back', 'btn-select':'Select',
                'btn-p-txt':'üìù Text', 'btn-p-img':'üì∑ Image', 'btn-p-vid':'üé• Video', 'btn-p-aud':'üéôÔ∏è Audio',
                'btn-v-txt':'Text', 'btn-v-img':'Image', 'btn-v-vid':'Video', 'btn-v-aud':'Audio',
                'btn-post-now':'Post', 'btn-dep':'Deposit', 'btn-with':'Withdraw', 'btn-intl':'Intl Purchase',
                't-edit-prof':'Edit Profile', 'btn-chg-pic':'Change Photo', 'btn-up-prof':'Update', 'btn-prof-out':'Logout',
                't-fb-sub':'To Admin (Text / Live)', 'btn-fb-txt':'Text', 'btn-fb-live':'Live', 'btn-view-fb':'View Feedbacks',
                't-choose-com':'Choose Comment Type', 't-post-instr':'Please enter content details', 't-com-act':'Action', 't-com-media':'Select Type'
            }
        };
// --- PART 13: UPLOAD LOGIC, SIGNUP & LOGIN FUNCTIONS ---

        function promptUpload(target) {
            uploadTarget = target;
            alert(lang === 'am' ? '·çã·ã≠·àç ·ã≠·àù·à®·å°' : 'Select File');
            let i = document.getElementById('file-profile');
            
            // Link target to specific hidden input IDs
            if(target === 'post') i = document.getElementById('file-post');
            if(target === 'deposit') i = document.getElementById('file-deposit');
            if(target === 'intl') i = document.getElementById('file-intl');
            if(target === 'pay') i = document.getElementById('file-pay');
            if(target.startsWith('chat')) i = document.getElementById('file-chat');
            if(target === 'profile-edit') i = document.getElementById('file-profile-edit');
            if(target === 'comment') i = document.getElementById('comment-file-input');
            
            i.click();
            i.onchange = () => { 
                showAlert(lang === 'am' ? '·â∞·àò·à≠·åß·àç' : 'Selected', "success");
                
                // Handle Receipt Flow for Money related uploads (using FileReader for Base64)
                if(target === 'deposit' || target === 'intl' || target === 'pay') {
                     const reader = new FileReader();
                     reader.onload = function(e) { triggerReceiptModal(e.target.result); }
                     reader.readAsDataURL(i.files[0]);
                     return; 
                }

                if(target === 'post') { 
                    document.getElementById('post-form-area').style.display = 'block'; 
                    document.getElementById('post-type-select').style.display = 'none';
                }
                
                if(target === 'comment') {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                         saveComment(activeCommentPostId, activePostType, e.target.result);
                    }
                    reader.readAsDataURL(i.files[0]);
                }
            };
        }

        function preSignup() {
            const p = document.getElementById('reg-phone').value; 
            const e = document.getElementById('reg-email').value;
            
            // Strict Validation Logic
            if(!p.match(/^09\d{8}$/)) return showAlert("Phone must start with 09 (10 digits)", "error");
            if(!e.endsWith("@gmail.com")) return showAlert("Email must be @gmail.com", "error");
            
            // Duplicate Check in Local Storage
            if(users.some(u => u.phone === p || u.email === e)) {
                return showAlert(lang === 'am' ? '·ã≠·àÖ ·àµ·àç·ä≠/·ä¢·àú·àç ·â∞·àò·ãù·åç·âß·àç (Already Registered)' : 'Already Registered', "error");
            }

            document.getElementById('signup-step-1').style.display = 'none';
            document.getElementById('signup-step-2').style.display = 'block';
        }

        function finalSignup() {
            const n = document.getElementById('reg-name').value; 
            const p = document.getElementById('reg-phone').value; 
            const e = document.getElementById('reg-email').value; 
            const pw = document.getElementById('reg-pass').value; 
            const f = document.getElementById('file-profile').files[0];
            
            if(!f) return showAlert("Photo required", "error");
            
            // Add to Local Users Array
            users.push({
                name: n, phone: p, email: e, password: pw, 
                balUSD: 0, balGBP: 0, balEUR: 0, balETB: 0, 
                photo: '', regDate: Date.now()
            });
            
            localStorage.setItem('fg_users', JSON.stringify(users));
            showAlert("Registered!", "success"); 
            showAuth('login');
        }

        function doLogin() {
            const p = document.getElementById('log-phone').value; 
            const pw = document.getElementById('log-pass').value;
            const u = users.find(x => x.phone === p && x.password === pw);
            
            if(u) { 
                user = u; 
                if(user.balETB === undefined) user.balETB = 0; 
                localStorage.setItem('fg_user', JSON.stringify(u)); 
                
                // Show Admin Button if authorized
                if(user.name === 'Admin' || user.name === 'Fasil') {
                    document.getElementById('btn-admin-rep').style.display = 'block';
                }
// --- PART 14: AUTH, LOGOUT & POST RENDERING LOGIC ---

        function doLogout() { 
            user = null; 
            localStorage.removeItem('fg_user'); 
            location.reload(); 
        }
        
        function checkAuth(sec) { 
            if(!user) return showAlert("Login First", "error");
            pendingAct = () => navTo(sec);
            // Show the password prompt modal for security before accessing sections like Admin/Business
            document.getElementById('pass-modal').style.display = 'flex';
        }

        // --- DASHBOARD UI ---
        function toggleList(t) { 
            const l = document.getElementById('list-' + t); 
            l.style.display = l.style.display === 'none' ? 'block' : 'none'; 
        }

        // --- POSTING SYSTEM ---
        function clearPostForm() {
            document.getElementById('p-title').value = '';
            document.getElementById('p-content').value = '';
            document.getElementById('file-post').value = '';
        }

        function setupPost(t) { 
            activePostType = t; 
            if(t !== 'text') {
                let i = document.getElementById('file-post');
                if(t === 'image') i.accept = 'image/*'; 
                if(t === 'video') i.accept = 'video/*'; 
                if(t === 'audio') i.accept = 'audio/*';
                promptUpload('post');
            } else {
                document.getElementById('post-form-area').style.display = 'block'; 
                document.getElementById('post-type-select').style.display = 'none';
                document.getElementById('p-content').style.display = 'block'; 
                document.getElementById('post-instr').textContent = "Title + Content Required";
            }
            if(t !== 'text') { 
                document.getElementById('p-content').style.display = 'none'; 
                document.getElementById('post-instr').textContent = "Title Required (No Details)"; 
            }
        }

        function submitPost() {
            const t = document.getElementById('p-title').value; 
            const c = document.getElementById('p-content').value;
            if(!t) return showAlert("Title required", "error");
            if(activePostType === 'text' && !c) return showAlert("Content required", "error");
            
            // Content Filtering (Strict Policy)
            const forbidden = ['politics', 'hate', 'war', 'racism', '·çñ·àà·â≤·ä´', '·ãò·à®·äù·äê·âµ', '·å¶·à≠·äê·âµ'];
            if(forbidden.some(w => (t + ' ' + c).toLowerCase().includes(w))) {
                return showAlert("·ä®·çñ·àä·à≤·ã´·âΩ·äï ·ãç·å≠ ·äê·ãç ·àò·àà·å†·çç ·ä†·ã≠·âª·àç·àù", "error");
            }

            const save = (d) => {
                posts.unshift({
                    id: Date.now(), t, c, d, 
                    type: activePostType, 
                    u: user.name, uid: user.phone, 
                    photo: user.photo, 
                    likes: 0, follows: 0, 
                    isHidden: false, comments: []
                });
                localStorage.setItem('fg_posts', JSON.stringify(posts));
                showAlert(lang === 'am' ? '·â∞·à≥·ä≠·â∑·àç' : 'Success', "success"); 
                
                clearPostForm();
                document.getElementById('post-form-area').style.display = 'none'; 
                document.getElementById('post-type-select').style.display = 'block';
                renderPosts(activePostType); 
                navTo('view-info');
            };

            if(activePostType !== 'text') { 
                const f = document.getElementById('file-post').files[0]; 
                if(f) { 
                    const r = new FileReader(); 
                    r.onload = e => save(e.target.result); 
                    r.readAsDataURL(f); 
                } else save(null); 
            } else {
                save(null);
            }
        }

        function renderPosts(type) {
            const c = document.getElementById('feed-container'); 
            c.innerHTML = '';
            const fs = posts.filter(p => p.type === type && !p.isHidden);
            if(!fs.length) {
                c.innerHTML = '<p style="text-align:center; color:#888;">Empty</p>';
                return;
            }
            
            fs.forEach(p => {
                let mediaTag = ''; 
                if(p.d) { 
                    if(p.type === 'image') mediaTag = `<img src="${p.d}" width="100%" style="border-radius:8px; margin-top:5px;">`; 
                    else if(p.type === 'video') mediaTag = `<video src="${p.d}" controls playsinline width="100%" style="border-radius:8px; margin-top:5px;"></video>`; 
                    else mediaTag = `<audio src="${p.d}" controls style="width:100%; margin-top:5px;"></audio>`; 
       // --- PART 15: POST CARD ACTIONS & COMMENT SYSTEM ---

                const isMine = p.uid === user.phone;
                // Delete button logic - only visible to the owner
                const delHtml = `<button class="btn-red btn-tiny" style="width:100%; margin-top:5px;" onclick="tryDelete(${p.id}, '${p.uid}')">Delete Post</button>`;
                
                c.innerHTML += `
                <div class="post-card">
                    <div class="post-header"><img src="lion_image.jpg"> <b>${p.u}</b></div>
                    <h4>${p.t}</h4>
                    <p>${p.c || ''}</p>
                    ${mediaTag}
                    <div class="post-actions">
                        <button class="action-icon" onclick="likePost(${p.id}, this)">Like ${p.likes || 0}</button>
                        <button class="action-icon" onclick="openComModal(${p.id})">Comment</button>
                        <button class="action-icon" onclick="sharePost()">Share</button>
                        <button class="action-icon" onclick="promptReport(${p.id}, '${p.u}')">Report</button>
                        <button class="action-icon" onclick="followUser(${p.id}, this)">Follow ${p.follows || 0}</button>
                    </div>
                    ${delHtml}
                </div>`;
            });
        }

        function tryDelete(id, uid) { 
            if(uid === user.phone) { 
                posts = posts.filter(p => p.id !== id); 
                localStorage.setItem('fg_posts', JSON.stringify(posts)); 
                showAlert('Deleted', 'success'); 
                renderPosts(activePostType); 
            } else {
                showAlert(lang === 'am' ? '·ã®·ä•·à≠·àµ·ãé ·ä†·ã≠·ã∞·àà·àù ·ã®·à∞·ãé·âΩ·äï ·àò·ã∞·àà·âµ ·ä†·ã≠·âΩ·àâ·àù' : 'Not yours', 'error'); 
            }
        }
        
        function likePost(id, btn) { 
            const p = posts.find(x => x.id === id); 
            p.likes = (p.likes || 0) + 1; 
            localStorage.setItem('fg_posts', JSON.stringify(posts)); 
            btn.innerHTML = `Like ${p.likes}`; 
        }

        function followUser(id, btn) { 
            const p = posts.find(x => x.id === id); 
            p.follows = (p.follows || 0) + 1; 
            localStorage.setItem('fg_posts', JSON.stringify(posts)); 
            btn.innerHTML = `Follow ${p.follows}`; 
        }

        function sharePost() { 
            document.getElementById('share-modal').style.display = 'flex'; 
        }

        function closeShare() { 
            document.getElementById('share-modal').style.display = 'none'; 
        }

        function shareTo(platform) {
            const txt = encodeURIComponent("Check this post on Fasil Web App!");
            let url = "";
            if(platform === 'telegram') url = `https://telegram.me/share/url?url=&text=${txt}`;
            if(platform === 'facebook') url = `https://www.facebook.com/sharer/sharer.php?u=&quote=${txt}`;
            if(platform === 'tiktok') url = `https://www.tiktok.com/`;
            if(platform === 'youtube') url = `https://www.youtube.com/`;
            
            window.open(url, '_blank');
            closeShare();
        }
        
        // --- COMMENT LOGIC ---
        function openComModal(id) { 
            activeCommentPostId = id; 
            document.getElementById('comment-type-modal').style.display = 'flex'; 
        }

        function openComSub(mode) { 
            comMode = mode; 
            document.getElementById('comment-type-modal').style.display = 'none'; 
            document.getElementById('comment-media-modal').style.display = 'flex';
        }

        function processComment(type) {
            document.getElementById('comment-media-modal').style.display = 'none';
            if(comMode === 'give') {
                if(type === 'text') {
                    const txt = prompt("Comment:"); 
                    if(!txt) return showAlert("Empty", "error");
                    saveComment(activeCommentPostId, type, txt);
                } else {
                    activePostType = type; // Temporary use for file input filter
                    const inp = document.getElementById('comment-file-input');
                    inp.accept = type + '/*';
                    inp.click();
                }
            } else {
                // View Comments logic starts here
                const p = posts.find(x => x.id === activeCommentPostId);   
// --- PART 16: COMMENT DISPLAY & ADMIN SECURITY ---

                const coms = (p.comments || []).filter(c => c.type === type);
                const disp = document.getElementById('comments-display-area');
                if(coms.length === 0) {
                    disp.innerHTML = "<p style='text-align:center;'>No Comments</p>";
                } else {
                    disp.innerHTML = coms.map(c => {
                        let content = c.txt;
                        if(c.type === 'image') content = `<img src="${c.txt}" width="100%" style="border-radius:5px;">`;
                        else if(c.type === 'video') content = `<video src="${c.txt}" controls width="100%" style="border-radius:5px;"></video>`;
                        else if(c.type === 'audio') content = `<audio src="${c.txt}" controls style="width:100%;"></audio>`;
                        
                        return `<div style="margin-bottom:10px; padding:5px; border-bottom:1px solid #eee;">
                                    <b>${c.u}:</b> <br> ${content}
                                </div>`;
                    }).join('');
                }
                document.getElementById('view-comments-list-modal').style.display = 'flex';
            }
        }

        function saveComment(pid, type, txt) {
            const p = posts.find(x => x.id === pid);
            if(!p.comments) p.comments = [];
            p.comments.push({u: user.name, type, txt});
            localStorage.setItem('fg_posts', JSON.stringify(posts));
            showAlert("Comment Sent", "success");
        }

        // --- ADMIN CORE FUNCTIONS ---
        function promptAdminLogin() { 
            document.getElementById('admin-login-modal').style.display = 'flex'; 
        }

        function adminLogin() {
            const code = document.getElementById('admin-pass-in').value;
            if(code === adminPass) { 
                document.getElementById('admin-login-modal').style.display = 'none'; 
                navTo('report-inbox'); 
            } else {
                alert("Wrong Code");
            }
        }
        
        function promptAdminAction(action) {
            pendingAdminAction = action;
            document.getElementById('admin-action-modal').style.display = 'flex';
        }

        function runAdminAction() {
            const p = document.getElementById('admin-act-pass').value;
            if(p === adminPass) {
                document.getElementById('admin-action-modal').style.display = 'none';
                document.getElementById('admin-act-pass').value = '';
                
                if(pendingAdminAction === 'changePass') document.getElementById('admin-chg-modal').style.display = 'block';
                else if(pendingAdminAction === 'userStats') showUserStats();
                else if(pendingAdminAction === 'premPay') document.getElementById('adm-prem-modal').style.display = 'block';
                else if(pendingAdminAction === 'viewRep') renderReports();
            } else {
                alert("Wrong Admin Code");
            }
        }

        // 1. Admin Password Change (Strict Format: 3 letters + 6 nums + 3 letters)
        function saveNewAdminPass() {
            const old = document.getElementById('old-adm').value;
            const newP = document.getElementById('new-adm').value;
            const confP = document.getElementById('conf-adm').value;
            
            if(old !== adminPass) return showAlert("Old Password Wrong", "error");
            if(newP !== confP) return showAlert("New Passwords mismatch", "error");
            
            // Regex: 3 small letters + 6 numbers + 3 small letters (Total 12)
            const regex = /^[a-z]{3}\d{6}[a-z]{3}$/;
            if(!regex.test(newP)) {
                return showAlert("Format: 3 small letters + 6 numbers + 3 small letters", "error");
            }
            
            adminPass = newP;
            localStorage.setItem('fg_admin_pass', newP);
            showAlert("Password Changed!", "success");
            document.getElementById('admin-chg-modal').style.display = 'none';
        }

        // 2. User Stats Logic
        function showUserStats() { 
            let html = users.map(u => {
                let userPosts = posts.filter(p => p.uid === u.phone);
                let totalLikes = userPosts.reduce((sum, p) => sum + (p.likes || 0), 0);
                let totalFollows = userPosts.reduce((sum, p) => sum + (p.follows || 0), 0);

// --- PART 17: USER STATS, REPORT HANDLING & WALLET LOGIC ---

                let regTime = u.regDate ? u.regDate : Date.now();
                let days = Math.floor((Date.now() - regTime) / (1000 * 60 * 60 * 24));
                
                let vids = userPosts.filter(p => p.type === 'video').length;
                let imgs = userPosts.filter(p => p.type === 'image').length;
                let auds = userPosts.filter(p => p.type === 'audio').length;

                return `
                <div class="post-card">
                    <img src="lion_image.jpg" width="30" style="border-radius:50%;"> <b>${u.name}</b><br>
                    Reg Days: ${days}<br>
                    Likes Received: ${totalLikes} | Follows Received: ${totalFollows}<br>
                    Posts: Video (${vids}), Image (${imgs}), Audio (${auds})
                </div>`;
            }).join('');
            document.getElementById('admin-dynamic-content').innerHTML = html || "No Users"; 
        }

        // 4. Reports Logic
        function promptReport(id, uname) { 
            const r = prompt("Reason for reporting this post:"); 
            if(r) { 
                const p = posts.find(x => x.id === id);
                reports.push({
                    id, reason: r, 
                    reporter: user.name, 
                    reporterPhoto: user.photo, 
                    target: uname, 
                    postContent: p.t
                }); 
                localStorage.setItem('fg_reports', JSON.stringify(reports)); 
                showAlert("Reported to Admin", "success"); 
            } 
        }

        function renderReports() {
            const c = document.getElementById('admin-dynamic-content'); 
            c.innerHTML = '';
            if(reports.length === 0) { c.innerHTML = "<p style='text-align:center;'>No Reports</p>"; return; }
            
            reports.forEach(r => {
                const p = posts.find(x => x.id === r.id);
                const isBanned = p ? p.isHidden : false;
                const statusClass = isBanned ? 'banned-text' : 'open-text';
                const containerClass = isBanned ? 'banned-indicator' : '';
                const statusTxt = isBanned ? "BANNED (Black)" : "OPEN (Blue)";

                c.innerHTML += `
                <div class="post-card ${containerClass}">
                    <b>Reporter:</b> ${r.reporter} <img src="lion_image.jpg" width="20" style="border-radius:50%;"><br> 
                    <b>Post Title:</b> ${r.postContent} <br> 
                    <b>Reason:</b> ${r.reason}<br>
                    Status: <span class="${statusClass}" style="font-weight:bold;">${statusTxt}</span><br>
                    <div style="margin-top:10px; display:flex; gap:5px;">
                        <button class="btn-red btn-small" onclick="banPost(${r.id})">Ban</button> 
                        <button class="btn-blue btn-small" onclick="unbanPost(${r.id})">Open/Unban</button>
                    </div>
                </div>`;
            });
        }

        function banPost(id) { 
            const p = posts.find(x => x.id === id); 
            if(p) p.isHidden = true; 
            localStorage.setItem('fg_posts', JSON.stringify(posts)); 
            showAlert("Content Banned", "success"); 
            renderReports(); 
        }

        function unbanPost(id) { 
            const p = posts.find(x => x.id === id); 
            if(p) p.isHidden = false; 
            localStorage.setItem('fg_posts', JSON.stringify(posts)); 
            showAlert("Content Restored", "success"); 
            renderReports(); 
        }

        // --- BUSINESS & WALLET SYSTEM ---
        function upBal() {
            // Display individual balances
            document.getElementById('bal-usd').innerText = user.balUSD.toFixed(2);
            document.getElementById('bal-gbp').innerText = user.balGBP.toFixed(2);
            document.getElementById('bal-eur').innerText = user.balEUR.toFixed(2);
            document.getElementById('bal-etb').innerText = user.balETB.toFixed(2);
            
            // Total in USD (Approx conversion for display)
            const tot = user.balUSD + (user.balGBP * 1.25) + (user.balEUR * 1.1) + (user.balETB / 120);
            document.getElementById('bal-total').innerText = tot.toFixed(2);
            
            // Total in ETB (Using defined RATES)
            const totEth = user.balETB + (user.balUSD * RATES.USD) + (user.balGBP * RATES.GBP) + (user.balEUR * RATES.EUR);
            document.getElementById('bal-total-etb').innerText = totEth.toFixed(2);
        }

        function preDeposit() { 
            document.getElementById('dep-step-1').style.display = 'none'; 
            document.getElementById('dep-step-2').style.display = 'block'; 
        }

        function finalizeDeposit() {
            const a = parseFloat(document.getElementById('dep-amt').value); 
            const c = document.getElementById('dep-cur').value;
// --- PART 18: FINANCIAL LOGIC, SECURITY & GROUP CHAT ---

            if(a >= 100) {
                // Currency conversion and balance update
                if(c === 'USD') user.balUSD += a / RATES.USD; 
                else if(c === 'GBP') user.balGBP += a / RATES.GBP; 
                else if(c === 'EUR') user.balEUR += a / RATES.EUR; 
                else user.balETB += a;
                
                localStorage.setItem('fg_user', JSON.stringify(user));
                showAlert("Deposited!", "success"); 
                upBal(); 
                document.getElementById('dep-step-1').style.display = 'block'; 
                document.getElementById('dep-step-2').style.display = 'none'; 
                navTo('business-sec');
            } else {
                showAlert("Min 100 ETB", "error");
            }
        }

        function toggleReceiverInput() {
            const m = document.getElementById('w-method').value;
            const i = document.getElementById('w-dest');
            i.style.display = 'block';
            // Contextual placeholders based on payment method
            i.placeholder = m === 'PayPal' ? 'Email (@gmail)' : (m === 'CBE' ? '1000... (13 digit)' : 'Phone 09...');
        }

        function reqWithdraw() {
            const m = document.getElementById('w-method').value; 
            const d = document.getElementById('w-dest').value;
            
            // Validation Logic
            if(m === 'Telebirr' && !/^09\d{8}$/.test(d)) return showAlert("Telebirr must be 09... (10 digits)", "error");
            if(m === 'PayPal' && !d.endsWith('@gmail.com')) return showAlert("Email required", "error");
            if(m === 'CBE' && (!d.match(/^(1000|10000)\d{9}$/) || d.length !== 13)) return showAlert("Invalid CBE", "error");
            if(!document.getElementById('w-amt').value) return showAlert("Please enter amount", "error"); 

            // Security check before processing withdrawal
            document.getElementById('pass-modal').style.display = 'flex';
            pendingAct = () => {
                const a = parseFloat(document.getElementById('w-amt').value);
                const c = document.getElementById('w-cur').value;
                
                // Deduct from balance
                if(c === 'USD') user.balUSD -= a; 
                if(c === 'GBP') user.balGBP -= a; 
                if(c === 'EUR') user.balEUR -= a; 
                if(c === 'ETB') user.balETB -= a;
                
                localStorage.setItem('fg_user', JSON.stringify(user));
                showAlert("Success", "success"); 
                navTo('business-sec');
            };
        }
        
        function triggerIntlPay(item) {
            document.getElementById('pass-modal').style.display = 'flex';
            pendingAct = () => { promptUpload('intl'); };
        }

        function verifyPass() { 
            if(document.getElementById('pass-input').value === user.password) { 
                document.getElementById('pass-modal').style.display = 'none'; 
                document.getElementById('pass-input').value = ''; // Clear for security
                if(pendingAct) pendingAct(); 
            } else {
                alert("Wrong Password"); 
            }
        }

        // --- PREMIUM SERVICES ---
        function openPrem(t) { navTo('prem-pricing'); }
        function pay(a) { document.getElementById('pay-up-area').style.display = 'block'; }
        function finPay() { showAlert("Activated!", "success"); goBack(); }

        // --- CHAT & USER LIST ---
        function handleGroupCreate() { showUserList(true); }

        function showUserList(selMode) {
            const c = document.getElementById('ul-cont'); 
            c.innerHTML = '';
            users.forEach(u => {
                if(u.phone === user.phone) return; // Don't show self
                c.innerHTML += `
                <div class="user-item" onclick="${selMode ? 'togBlue(this)' : ''}">
                    <img src="lion_image.jpg" style="border-radius:50%;"> 
                    <b>${u.name}</b>
                </div>`;
            });
            document.getElementById('btn-grp-done').style.display = selMode ? 'block' : 'none';
            navTo('user-list-sec');
        }

        function togBlue(el) { 
            el.classList.toggle('bright-blue'); 
            checkGrpCount(); 
        }

        function checkGrpCount() {
            const cnt = document.querySelectorAll('.bright-blue').length;
            // Requirement: Must select at least 5 people for a group
            document.getElementById('btn-grp-done').style.display = cnt >= 5 ? 'block' : 'none';
        }

        function createGroup() {
            const n = prompt("Enter Group Name:"); 
            if(n) {
                groups.push({id: Date.now(), name: n, creator: user.phone, msgs: []});
                localStorage.setItem('fg_groups', JSON.stringify(groups));
// --- PART 19: CHAT SYSTEM, LIVE CAMERA, PROFILE & FEEDBACK ---

                showAlert("Group Created", "success"); 
                goBack();
            }
        }

        function showMyGroups() {
            const c = document.getElementById('grp-list'); 
            c.innerHTML = '';
            groups.forEach(g => {
                const mine = g.creator === user.phone;
                const txt = mine ? (lang === 'am' ? '·ä•·à≠·àµ·ãé ·ã®·çà·å†·à©·âµ' : 'Yours') : (lang === 'am' ? '·ã®·ä•·à≠·àµ·ãé ·ä†·ã≠·ã∞·àà·àù' : 'Not Yours');
                // Only allow group owner to open the chat in this specific logic
                c.innerHTML += `
                <div class="user-item" onclick="${mine ? 'openGrp(' + g.id + ')' : 'alert(\'' + txt + '\')'}">
                    <b>${g.name}</b> <small>(${txt})</small>
                </div>`; 
            });
            navTo('my-groups-sec');
        }

        function handleChatList() { 
            showUserList(false); 
            const items = document.querySelectorAll('.user-item');
            const targetUsers = users.filter(u => u.phone !== user.phone);
            items.forEach((item, idx) => {
                item.onclick = () => openChat(targetUsers[idx].phone);
            });
        }

        function openChat(ph) { activeChat = {type: 'p', id: ph}; navTo('chat-sec'); renderChat(); }
        function openGrp(id) { activeChat = {type: 'g', id: id}; navTo('chat-sec'); renderChat(); }

        function sendChat(t) {
            const txt = document.getElementById('chat-in').value; 
            if(!txt) return;
            const msg = {u: user.name, t: txt, type: t, time: Date.now()};
            
            if(activeChat.type === 'p') { 
                // Create a unique key for 1-on-1 chat using both phone numbers
                const k = [user.phone, activeChat.id].sort().join('_'); 
                if(!chats[k]) chats[k] = []; 
                chats[k].push(msg); 
                localStorage.setItem('fg_chats', JSON.stringify(chats)); 
            } else { 
                const g = groups.find(x => x.id === activeChat.id); 
                g.msgs.push(msg); 
                localStorage.setItem('fg_groups', JSON.stringify(groups)); 
            }
            document.getElementById('chat-in').value = ''; // Clear input
            renderChat();
        }

        function renderChat() {
            const c = document.getElementById('chat-box'); 
            let msgs = [];
            if(activeChat.type === 'p') { 
                const k = [user.phone, activeChat.id].sort().join('_'); 
                msgs = chats[k] || []; 
            } else {
                msgs = groups.find(x => x.id === activeChat.id).msgs;
            }
            c.innerHTML = msgs.map(m => `
                <div style="margin-bottom:8px; text-align: ${m.u === user.name ? 'right' : 'left'}">
                    <small>${m.u}</small><br>
                    <span style="background:#e1f5fe; padding:5px 10px; border-radius:10px; display:inline-block;">${m.t}</span>
                </div>`).join('');
            c.scrollTop = c.scrollHeight; // Auto scroll to bottom
        }
        
        // --- LIVE STREAMING ---
        function openLiveCamera() {
            showView('view-live');
            if(navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                navigator.mediaDevices.getUserMedia({ video: true, audio: true })
                .then(stream => {
                    liveStream = stream;
                    document.getElementById('live-video-element').srcObject = stream;
                })
                .catch(err => {
                    showAlert("Camera Access Denied", "error");
                    goBack();
                });
            }
        }

        function stopLive() {
            if(liveStream) {
                liveStream.getTracks().forEach(track => track.stop());
            }
            goBack();
        }

        // --- PROFILE MANAGEMENT ---
        function saveProfile() {
            const n = document.getElementById('prof-name-edit').value; 
            const o = document.getElementById('old-pass').value; 
            const p = document.getElementById('new-pass').value; 
            const cp = document.getElementById('conf-pass').value;
            
            if(p && p !== cp) return showAlert("Passwords do not match", "error");
            if(o && o !== user.password) return showAlert("Old Password Wrong", "error");
            
            if(n) user.name = n; 
            if(p) user.password = p;
            
            localStorage.setItem('fg_user', JSON.stringify(user));
            // Update global users array too
            const idx = users.findIndex(u => u.phone === user.phone);
            users[idx] = user;
            localStorage.setItem('fg_users', JSON.stringify(users));
            
            showAlert("Profile Updated", "success");
        }

        // --- FEEDBACK SYSTEM ---
        function giveFb(t) {
            if(t === 'live') {
                openLiveCamera();
            } else { 
                const x = prompt("Write your feedback to Fasil:"); 
                if(x) { 
                    feedbacks.push({u: user.name, c: x, date: Date.now()}); 
                    localStorage.setItem('fg_fbs', JSON.stringify(feedbacks)); 
                    showAlert("Feedback Sent", "success"); 
                } 
            }
        }

        function viewFbs() { 
            const list = document.getElementById('fb-list');
            list.innerHTML = feedbacks.map(f => `
                <div style="border-bottom:1px solid #ddd; padding:5px;">
                    <b>${f.u}:</b> ${f.c}
                </div>`).join(''); 
        }

        // Initialize App Language on Load
        toggleLanguage(); toggleLanguage(); 
    </script>
// --- PART 20: FIREBASE CONFIGURATION & CLOSING ---

  const firebaseConfig = {
    apiKey: "AIzaSyAWS8PJ0kmu56hixesxV1KrMH8NRciH6U0",
    authDomain: "fasil-web-app-3a732.firebaseapp.com",
    projectId: "fasil-web-app-3a732",
    storageBucket: "fasil-web-app-3a732.firebasestorage.app",
    messagingSenderId: "239133072986",
    appId: "1:239133072986:web:0dcbd768e1e916b9b64263"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);

  console.log("Fasil Web App is successfully initialized!");
</script>

</body>
</html>

