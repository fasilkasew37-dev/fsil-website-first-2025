áˆ€<!DOCTYPE html>
<html lang="am">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>á‹áˆ²áˆ á‹Œá‰¥ áŠ á• - Fasil Web App</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* --- áˆ˜á‹°á‰ áŠ› CSS (á‹¨á‹µáˆ®á‹ áŠ¦áˆªáŒ‚áŠ“áˆ) --- */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            text-align: center; padding: 20px; background-color: #f0f4f8; color: #333; margin: 0; padding-bottom: 80px;
        }
        .section {
            max-width: 700px; margin: 20px auto; padding: 25px;
            background: white; border-radius: 12px; box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            border-top: 6px solid #007bff; text-align: left; display: none;
        }
        #agreement-view { display: block; }
        
        h1, h2 { text-align: center; }
        h1 { color: #007bff; font-size: 28px; }
        h2 { color: #555; font-size: 22px; }

        input, select, textarea {
            width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; font-size: 16px;
        }
        
        /* Buttons */
        button, .button-link {
            display: block; width: 100%; padding: 15px; margin: 12px 0;
            text-align: center; border-radius: 8px; font-weight: bold;
            cursor: pointer; border: none; font-size: 16px; color: white; transition: 0.3s;
        }
        .main-btn { background-color: #007bff; }
        .success-btn { background-color: #28a745; }
        .delete-btn { background-color: #dc3545; }
        .premium-btn { background-color: #ffc107; color: #333; }
        .feature-btn { background-color: #8c5aee; }
        .business-btn { background-color: #00a08e; }
        .social-btn { background-color: #ff7043; }
        .language-btn { background-color: #6c757d; }

        /* Modals */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.6); display: none;
            justify-content: center; align-items: center; z-index: 2000;
        }
        .modal-box {
            background: white; padding: 25px; border-radius: 12px;
            width: 85%; max-width: 400px; text-align: center; max-height: 80vh; overflow-y: auto;
        }

        /* Post Card */
        .post-card {
            border: 1px solid #ddd; padding: 15px; margin-bottom: 15px; border-radius: 8px; background: #f9f9f9;
        }
        .user-header { display: flex; align-items: center; margin-bottom: 10px; }
        .user-header img { width: 40px; height: 40px; border-radius: 50%; margin-right: 10px; }
        
        .action-row { display: flex; justify-content: space-between; margin-top: 10px; border-top: 1px solid #eee; padding-top: 5px; }
        .tiny-btn { background: none; border: none; color: #007bff; font-size: 13px; cursor: pointer; padding: 5px; width: auto; display: inline; }
        
        /* Live Video */
        #live-video-element { width: 100%; height: 300px; background: black; border-radius: 10px; margin-bottom: 10px; }

        .hidden { display: none; }
    </style>
</head>
<body>

    <!-- Alert Modal -->
    <div class="modal-overlay" id="custom-modal">
        <div class="modal-box">
            <h3 id="modal-title"></h3>
            <p id="modal-text"></p>
            <button class="main-btn" onclick="closeModal()">OK</button>
        </div>
    </div>

    <!-- Password Modal -->
    <div class="modal-overlay" id="password-modal">
        <div class="modal-box">
            <h3>Password Required</h3>
            <input type="password" id="modal-password-input" placeholder="Password" style="text-align: center;">
            <button class="success-btn" onclick="confirmActionWithPassword()">Confirm</button>
            <button class="delete-btn" onclick="document.getElementById('password-modal').style.display='none'">Cancel</button>
        </div>
    </div>

    <!-- Share Modal -->
    <div class="modal-overlay" id="share-modal">
        <div class="modal-box">
            <h3>Share To</h3>
            <button class="main-btn" onclick="closeShare()">Telegram</button>
            <button class="main-btn" onclick="closeShare()">Facebook</button>
            <button class="main-btn" onclick="closeShare()">TikTok</button>
            <button class="delete-btn" onclick="closeShare()">Close</button>
        </div>
    </div>

    <!-- View Feedback Type Modal -->
    <div class="modal-overlay" id="fb-type-modal">
        <div class="modal-box">
            <h3>View Feedback As:</h3>
            <button class="main-btn" onclick="viewFeedbackContent('text')">Text</button>
            <button class="main-btn" onclick="viewFeedbackContent('image')">Image</button>
            <button class="main-btn" onclick="viewFeedbackContent('voice')">Voice</button>
            <button class="delete-btn" onclick="document.getElementById('fb-type-modal').style.display='none'">Cancel</button>
        </div>
    </div>

    <!-- 1. Agreement View -->
    <div class="section" id="agreement-view">
        <h1 id="t-welcome">áŠ¥áŠ•áŠ³áŠ• á‹ˆá‹° á‹áˆ²áˆ á‹Œá‰¥ á‰ á‹°áˆ…áŠ“ áˆ˜áŒ¡</h1>
        <div style="background:#e9ecef; padding:20px; border-radius:8px;">
            <h3>ğŸŒ áˆµáˆˆ áŠ á•áˆŠáŠ¬áˆ½áŠ‘</h3>
            <p id="t-intro">á‹áˆ²áˆ á‹Œá‰¥ áŠ á• á‹²áŒ‚á‰³áˆ áˆ˜áŒ‹áˆªá‹« áˆ˜á‹µáˆ¨áŠ­ áŠá‹á¢ áŠ¥á‹áŠá‰°áŠ› áˆ˜áˆ¨áŒƒá‹á‰½áŠ• áˆ˜áˆ˜áˆáŠ¨á‰µ áŠ¥áŠ“ áˆ˜áŒ‹áˆ«á‰µ á‹­á‰½áˆ‹áˆ‰á¢ á‰ á‰°áŒ¨áˆ›áˆªáˆ á“á‹ˆáˆ­ á–á‹­áŠ•á‰µ áŠ¥áŠ“ á’á‹²áŠ¤á áŠ áŒˆáˆáŒáˆá‰¶á‰½áŠ• á‹«áŒˆáŠ›áˆ‰á¢</p>
        </div>
        <div style="background:#ffe0b2; padding:20px; margin-top:20px; border-left:5px solid orange;">
            <h3>âš ï¸ áŒ¥á‰¥á‰… áˆ˜áˆ˜áˆªá‹«</h3>
            <p id="t-rules">á–áˆˆá‰²áŠ«á‹Š áŒáŒ­á‰µá£ á‹¨áˆƒá‹­áˆ›áŠ–á‰µ áŒ¥áˆ‹á‰»á£ á‹˜áˆ¨áŠáŠá‰µ á‹ˆá‹­áˆ áˆŒáˆ‹ á‹¨áŒáŒ­á‰µ áŠ áŒ€áŠ•á‹³ áˆ›áŠ«áˆ„á‹µ á‰ áŒ¥á‰¥á‰… á‹¨á‰°áŠ¨áˆˆáŠ¨áˆˆ áŠá‹á¢ á–áˆŠáˆ²á‹«á‰½áŠ•áŠ• áŒ¥áˆ°á‹ áŠ¨á‰°áŒˆáŠ™ á‰ áŒ¥á‰¥á‰… á‹¨áˆ²áˆµá‰°áˆ á‰áŒ¥áŒ¥áˆ­ á‰ áˆ«áˆµ áˆ°áˆ­ áŠ¨áŠ áŒˆáˆáŒáˆá‰µ á‹­á‰³áŒˆá‹³áˆ‰á¢</p>
        </div>
        <h2 id="t-agree-q">á‹­á‰€á‰ áˆ‹áˆ‰?</h2>
        <button class="success-btn" onclick="showView('home-view')">âœ… áŠ¥áˆµáˆ›áˆ›áˆˆáˆ</button>
        <button class="delete-btn" onclick="showAlert('áˆ˜áŒ á‰€áˆ áŠ á‹­á‰½áˆ‰áˆá¢', 'error')">âŒ áŠ áˆáˆµáˆ›áˆ›áˆ</button>
        <button class="language-btn" onclick="toggleLanguage()">Language: Amharic/English</button>
    </div>

    <!-- 2. Home View -->
    <div class="section" id="home-view">
        <h1 id="t-home">á‹¨áˆ˜áŒá‰¢á‹« áˆáˆ­áŒ«</h1>
        <button class="main-btn" onclick="showView('signup-form')" id="btn-free-sign">á‰ áŠáƒ áˆˆáˆ˜áˆ˜á‹áŒˆá‰¥ / áˆˆáˆ˜áŒá‰£á‰µ</button>
        <button class="premium-btn" onclick="checkFreeSignupForPremium()" id="btn-pay-sign">á‰ áŠ­áá‹« áŠ áˆ›áˆ«áŒ­ áˆˆáˆ˜áˆ˜á‹áŒˆá‰¥</button>
        <button class="language-btn" onclick="toggleLanguage()">Language: Amharic/English</button>
        <button class="delete-btn" onclick="showView('agreement-view')" style="margin-top:30px;">á‹ˆá‹° áˆ˜áˆ˜áˆªá‹« á‰°áˆ˜áˆˆáˆµ</button>
    </div>

    <!-- 3. Signup Form (Updated Logic) -->
    <div class="section" id="signup-form">
        <h2 id="t-reg">áŠ á‹²áˆµ áˆá‹áŒˆá‰£</h2>
        <!-- Step 1: Info -->
        <div id="signup-step-1">
            <input type="text" id="signup-name" placeholder="Full Name">
            <input type="text" id="signup-phone" placeholder="Phone (09... 10 digits)">
            <input type="email" id="signup-email" placeholder="Email (@gmail.com only)">
            <input type="password" id="signup-password" placeholder="Password (6 digits)">
            <button class="success-btn" onclick="preSignup()">Submit</button>
        </div>
        <!-- Step 2: Photo -->
        <div id="signup-step-2" class="hidden">
            <p>**Profile Photo**</p>
            <input type="file" id="signup-profile-photo" accept="image/*">
            <button class="success-btn" onclick="handleSignUp()">Finish Registration</button>
        </div>
        <p style="text-align:center; color:#007bff; cursor:pointer;" onclick="showView('login-form')">á‰°áˆ˜á‹áŒá‰ á‹‹áˆ? á‹­áŒá‰¡</p>
    </div>

    <!-- 4. Login Form -->
    <div class="section" id="login-form">
        <h2 id="t-log">áˆ˜áŒá‰¢á‹«</h2>
        <input type="text" id="login-phone" placeholder="Phone">
        <input type="password" id="login-password" placeholder="Password">
        <button class="main-btn" onclick="handleLogin()">áŒá‰£</button>
        <p style="text-align:center; color:#007bff; cursor:pointer;" onclick="showView('signup-form')">áŠ á‹²áˆµ áŠá‹á‰µ? á‹­áˆ˜á‹áŒˆá‰¡</p>
    </div>

    <!-- 5. Dashboard -->
    <div class="section" id="dashboard-view">
        <h1 id="t-dash">á‹³áˆ½á‰¦áˆ­á‹µ</h1>
        
        <button class="main-btn" onclick="showView('view-select')" id="btn-view">ğŸ“„ áˆ˜áˆ¨áŒƒ áˆ˜áˆ˜áˆáŠ¨á‰µ</button>
        <button class="main-btn" onclick="showView('post-select')" id="btn-post">âœï¸ áˆ˜áˆ¨áŒƒ áˆ˜áˆˆáŒ á</button>
        
        <button class="feature-btn" onclick="showUserList(false)" id="btn-users">ğŸ‘¥ á‹¨á‹áˆ²áˆ á‹Œá‰¥ áŠ á• á‰°áŒ á‰ƒáˆšá‹á‰½</button>

        <button class="social-btn" onclick="handleGroupCreation()" id="btn-grp">ğŸ‘¥ á‰¡á‹µáŠ• áˆˆáˆ˜ááŒ áˆ­</button>
        <button class="social-btn" style="background-color: #5e35b1;" onclick="showMyGroupsList()" id="btn-mygrp">ğŸ“‚ á‹¨áˆáŒ áˆ©á‰µáŠ• áŒáˆ©á• áˆˆáˆ˜áˆ˜áˆáŠ¨á‰µ</button>
        <button class="social-btn" onclick="handlePrivateChatStart()" id="btn-chat">ğŸ’¬ á‰ á‹áˆµáŒ¥ áˆ˜áˆµáˆ˜áˆ­ áˆ›á‹áˆ«á‰µ</button>
        
        <button class="success-btn" style="background-color: #00bcd4;" onclick="showView('feedback-to-admin')" id="btn-fb">ğŸ“ áˆˆáˆáŒ£áˆª áŠ áˆµá‰°á‹«á‹¨á‰µ áˆˆáˆ˜áˆµáŒ á‰µ áŠ¥áŠ“ áˆˆáˆ˜áˆ˜áˆáŠ¨á‰µ</button>

        <button class="business-btn" onclick="checkAuthAndRedirect('business-dashboard')" id="btn-biz">ğŸ’° á‰¢á‹áŠáˆµ áˆ›á‹•áŠ¨áˆ</button>
        <button class="delete-btn" style="background-color: #333;" onclick="checkAuthAndRedirect('admin-report-view')" id="btn-admin">ğŸ”´ áˆªá–áˆ­á‰µ áˆ˜á‰€á‰ á‹« (Admin)</button>
        
        <button class="feature-btn" style="background-color: #ffc107; color: black;" onclick="showView('premium-services-list')" id="btn-prem">â­ï¸ á‹¨áŠ­áá‹« áŠ áŒˆáˆáŒáˆá‰¶á‰½</button>

        <button class="language-btn" onclick="toggleLanguage()">Language: Amharic/English</button>
        <button class="delete-btn" style="margin-top:20px; background:#6c757d;" onclick="handleLogout()">á‹áŒ£</button>
    </div>

    <!-- 6. Post Select -->
    <div class="section" id="post-select">
        <h2 id="t-post-q">áˆáŠ• áˆ˜áˆˆáŒ á á‹­áˆáˆáŒ‹áˆ‰?</h2>
        <button class="main-btn" onclick="setupPost('text')">ğŸ“ á…áˆá (Text)</button>
        <button class="main-btn" onclick="setupPost('image')">ğŸ“· áˆáˆµáˆ (Image)</button>
        <button class="main-btn" onclick="setupPost('video')">ğŸ¥ á‰ªá‹²á‹® (Video)</button>
        <button class="main-btn" onclick="setupPost('audio')">ğŸ™ï¸ á‹µáˆá… (Audio)</button>
        
        <!-- Post Form Area -->
        <div id="post-form-container" class="hidden" style="margin-top:20px; border-top:1px solid #ccc; padding-top:10px;">
            <p id="post-instruction" style="font-size:12px; color:blue;"></p>
            <input type="file" id="post-file-input" class="hidden">
            <input type="text" id="post-title-input" placeholder="áˆ­á‹•áˆµ (Title) - Required">
            <textarea id="post-content-input" placeholder="á‹áˆ­á‹áˆ­ áˆ€áˆ³á‰¥ (Details)..." rows="5"></textarea>
            <button class="success-btn" onclick="createNewPost()">á‹­áˆˆáŒ¥á‰ (Post)</button>
        </div>

        <button class="delete-btn" onclick="goBack()">á‰°áˆ˜áˆˆáˆµ</button>
    </div>

    <!-- 7. View Select -->
    <div class="section" id="view-select">
        <h2 id="t-view-q">áˆáŠ• áˆ˜áˆ˜áˆáŠ¨á‰µ á‹­áˆáˆáŒ‹áˆ‰?</h2>
        <button class="main-btn" onclick="displayPosts('text')">ğŸ“ á…áˆá</button>
        <button class="main-btn" onclick="displayPosts('image')">ğŸ“· áˆáˆµáˆ</button>
        <button class="main-btn" onclick="displayPosts('audio')">ğŸ¥ á‰ªá‹²á‹®/á‹µáˆá…</button>
        <button class="delete-btn" onclick="goBack()">á‰°áˆ˜áˆˆáˆµ</button>
    </div>

    <!-- 8. Posts Viewer -->
    <div class="section" id="posts-viewer">
        <h2>á‹áˆ­á‹áˆ­</h2>
        <div id="posts-container"></div>
        <button class="delete-btn" onclick="showView('view-select')">á‰°áˆ˜áˆˆáˆµ</button>
    </div>

    <!-- 9. Admin Report View -->
    <div class="section" id="admin-report-view">
        <h2>áˆªá–áˆ­á‰µ áˆ˜á‰€á‰ á‹« (Admin)</h2>
        <div id="report-container"></div>
        <button class="delete-btn" onclick="goBack()">á‰°áˆ˜áˆˆáˆµ</button>
    </div>

    <!-- 10. Business Dashboard -->
    <div class="section" id="business-dashboard">
        <h2>ğŸ’° á‹¨á‰¢á‹áŠáˆµ áˆ›á‹•áŠ¨áˆ</h2>
        <div style="background:#00a08e; color:white; padding:15px; border-radius:8px;">
            <h3>Balance: <span id="main-usd">0.00</span> USD</h3>
            <p>GBP: <span id="bal-gbp">0.00</span> | EUR: <span id="bal-eur">0.00</span></p>
            <p style="color:yellow; font-weight:bold;">ETB: <span id="bal-etb">0.00</span></p>
            <hr>
            <p style="color:red; font-weight:bold;">Total Estimated ETB: <span id="total-est-etb">0.00</span></p>
        </div>
        <button class="success-btn" onclick="showView('deposit-view')">áŒˆáŠ•á‹˜á‰¥ áˆˆáˆ›áˆµáŒˆá‰£á‰µ</button>
        <button class="main-btn" onclick="showView('withdraw-view')">áŒˆáŠ•á‹˜á‰¥ áˆˆáˆ›á‹áŒ£á‰µ</button>
        <button class="premium-btn" onclick="showView('intl-purchase-view')">á‹“áˆˆáˆ áŠ á‰€á áŒá‹¢</button>
        <button class="delete-btn" onclick="goBack()">á‰°áˆ˜áˆˆáˆµ</button>
    </div>

    <!-- 11. Deposit -->
    <div class="section" id="deposit-view">
        <h2>ğŸ’µ áŒˆáŠ•á‹˜á‰¥ áˆ›áˆµáŒˆá‰£á‰µ</h2>
        <div id="dep-step-1">
            <input type="number" id="deposit-amount" placeholder="ETB Amount">
            <select id="deposit-target-currency">
                <option value="ETB">ETB</option><option value="USD">USD</option><option value="GBP">GBP</option><option value="EUR">EUR</option>
            </select>
            <button class="success-btn" onclick="preDeposit()">Submit</button>
        </div>
        <div id="dep-step-2" class="hidden">
            <p>Upload Receipt:</p>
            <input type="file" id="deposit-receipt">
            <button class="success-btn" onclick="handleDeposit()">Finish</button>
        </div>
        <button class="delete-btn" onclick="goBack()">Cancel</button>
    </div>

    <!-- 12. Withdraw -->
    <div class="section" id="withdraw-view">
        <h2>ğŸ’¸ áŒˆáŠ•á‹˜á‰¥ áˆ›á‹áŒ£á‰µ</h2>
        <select id="withdraw-source-currency">
            <option value="USD">From USD</option><option value="GBP">From GBP</option><option value="EUR">From EUR</option><option value="ETB">From ETB</option>
        </select>
        <input type="number" id="withdraw-amount" placeholder="Amount">
        <select id="withdraw-method" onchange="toggleReceiverInput()">
            <option value="Telebirr">Telebirr</option><option value="CBE">CBE</option><option value="PayPal">PayPal</option>
        </select>
        <input type="text" id="withdraw-receiver" placeholder="Receiver Info" style="display:none;">
        <button class="main-btn" onclick="initiateWithdraw()">Withdraw</button>
        <button class="delete-btn" onclick="goBack()">Cancel</button>
    </div>

    <!-- 13. Intl Purchase -->
    <div class="section" id="intl-purchase-view">
        <h2>ğŸŒ International Purchase</h2>
        <button class="main-btn" onclick="document.getElementById('intl-list').style.display='block'">áˆáˆ¨áŒ¥ (Select)</button>
        <div id="intl-list" class="hidden" style="margin-top:10px;">
            <select id="intl-service">
                <option>1. ChatGPT</option><option>2. Amazon</option><option>3. Hosting</option><option>4. Domain</option><option>5. Netflix</option>
            </select>
            <input type="number" id="intl-amount" placeholder="Amount ($)">
            <button class="success-btn" onclick="handleIntlPurchase()">Pay</button>
        </div>
        <button class="delete-btn" onclick="goBack()">Cancel</button>
    </div>

    <!-- 14. Feedback -->
    <div class="section" id="feedback-to-admin">
        <h2>ğŸ“ Feedback</h2>
        <button class="main-btn" onclick="handleAdminFeedback('text')">Text</button>
        <button class="premium-btn" onclick="openLiveCamera()">Live (Direct Video)</button>
        <button class="delete-btn" onclick="goBack()">á‰°áˆ˜áˆˆáˆµ</button>
    </div>

    <!-- 15. Live View (Real Camera) -->
    <div class="section" id="live-view">
        <h2>Live Stream</h2>
        <video id="live-video-element" autoplay playsinline></video>
        <button class="delete-btn" onclick="stopLiveCamera()">Stop Live</button>
    </div>

    <!-- 16. User List -->
    <div class="section" id="user-list-view">
        <h2>á‰°áŒ á‰ƒáˆšá‹á‰½</h2>
        <div id="user-list-container"></div>
        <button id="user-list-action-btn" class="success-btn hidden">Done (Create Group)</button>
        <button class="delete-btn" onclick="goBack()">á‰°áˆ˜áˆˆáˆµ</button>
    </div>

    <script>
        // --- DATA ---
        let currentUser = JSON.parse(localStorage.getItem('fasil_user')) || null;
        let users = JSON.parse(localStorage.getItem('fasil_users')) || [];
        let posts = JSON.parse(localStorage.getItem('fasil_posts')) || [];
        let groups = JSON.parse(localStorage.getItem('fasil_groups')) || [];
        let reports = JSON.parse(localStorage.getItem('fasil_reports')) || [];
        
        let pendingAction = null;
        let currentLang = 'am';
        let activePostType = 'text';
        let viewHistory = []; // Stack for Back button logic
        let streamObj = null;

        const RATES = { USD:120, GBP:150, EUR:130 };
        const TXT = {
            'am': {
                't-welcome':'áŠ¥áŠ•áŠ³áŠ• á‹ˆá‹° á‹áˆ²áˆ á‹Œá‰¥ á‰ á‹°áˆ…áŠ“ áˆ˜áŒ¡', 't-intro':'á‹­áˆ… á‹¨á‹áˆ²áˆ á‹Œá‰¥ áŠ á• á‰ á‰°áŠ áˆ›áŠ’áŠá‰µ áŠ¥áŠ•á‹²áˆ°áˆ« á‹¨á‰°á‰€á‹¨áˆ° á‹²áŒ‚á‰³áˆ áˆ˜áˆ¨áŒƒ áˆ˜áŒ‹áˆªá‹« áŠá‹á¢',
                't-rules':'á–áˆˆá‰²áŠ«á‹Š áŒáŒ­á‰µá£ á‹¨áˆƒá‹­áˆ›áŠ–á‰µ áŒ¥áˆ‹á‰»á£ á‹˜áˆ¨áŠáŠá‰µ á‹ˆá‹­áˆ áˆŒáˆ‹ á‹¨áŒáŒ­á‰µ áŠ áŒ€áŠ•á‹³ áˆ›áŠ«áˆ„á‹µ á‰ áŒ¥á‰¥á‰… á‹¨á‰°áŠ¨áˆˆáŠ¨áˆˆ áŠá‹á¢',
                't-home':'á‹¨áˆ˜áŒá‰¢á‹« áˆáˆ­áŒ«', 'btn-free-sign':'á‰ áŠáƒ áˆˆáˆ˜áˆ˜á‹áŒˆá‰¥ / áˆˆáˆ˜áŒá‰£á‰µ', 'btn-pay-sign':'á‰ áŠ­áá‹« áŠ áˆ›áˆ«áŒ­ áˆˆáˆ˜áˆ˜á‹áŒˆá‰¥',
                't-dash':'á‹³áˆ½á‰¦áˆ­á‹µ', 'btn-view':'ğŸ“„ áˆ˜áˆ¨áŒƒ áˆ˜áˆ˜áˆáŠ¨á‰µ', 'btn-post':'âœï¸ áˆ˜áˆ¨áŒƒ áˆ˜áˆˆáŒ á', 'btn-users':'ğŸ‘¥ á‹¨á‹áˆ²áˆ á‹Œá‰¥ áŠ á• á‰°áŒ á‰ƒáˆšá‹á‰½',
                'btn-grp':'ğŸ‘¥ á‰¡á‹µáŠ• áˆˆáˆ˜ááŒ áˆ­', 'btn-mygrp':'ğŸ“‚ á‹¨áˆáŒ áˆ©á‰µáŠ• áŒáˆ©á• áˆˆáˆ˜áˆ˜áˆáŠ¨á‰µ', 'btn-chat':'ğŸ’¬ á‰ á‹áˆµáŒ¥ áˆ˜áˆµáˆ˜áˆ­ áˆ›á‹áˆ«á‰µ',
                'btn-fb':'ğŸ“ áˆˆáˆáŒ£áˆª áŠ áˆµá‰°á‹«á‹¨á‰µ áˆˆáˆ˜áˆµáŒ á‰µ áŠ¥áŠ“ áˆˆáˆ˜áˆ˜áˆáŠ¨á‰µ', 'btn-biz':'ğŸ’° á‰¢á‹áŠáˆµ áˆ›á‹•áŠ¨áˆ', 'btn-admin':'ğŸ”´ áˆªá–áˆ­á‰µ áˆ˜á‰€á‰ á‹« (Admin)',
                't-post-q':'áˆáŠ• áˆ˜áˆˆáŒ á á‹­áˆáˆáŒ‹áˆ‰?', 't-view-q':'áˆáŠ• áˆ˜áˆ˜áˆáŠ¨á‰µ á‹­áˆáˆáŒ‹áˆ‰?'
            },
            'en': {
                't-welcome':'Welcome to Fasil Web App', 't-intro':'Fasil Web App is a reliable digital sharing platform.',
                't-rules':'Political conflict, religious hatred, and racism are strictly prohibited.',
                't-home':'Login Selection', 'btn-free-sign':'Free Signup / Login', 'btn-pay-sign':'Premium Signup',
                't-dash':'Dashboard', 'btn-view':'ğŸ“„ View Info', 'btn-post':'âœï¸ Post Info', 'btn-users':'ğŸ‘¥ Users List',
                'btn-grp':'ğŸ‘¥ Create Group', 'btn-mygrp':'ğŸ“‚ My Groups', 'btn-chat':'ğŸ’¬ Private Chat',
                'btn-fb':'ğŸ“ Feedback', 'btn-biz':'ğŸ’° Business Center', 'btn-admin':'ğŸ”´ Report Inbox',
                't-post-q':'What to Post?', 't-view-q':'What to View?'
            }
        };

        // --- NAVIGATION & UTILS ---
        function toggleLanguage() {
            currentLang = currentLang==='am'?'en':'am';
            const t = TXT[currentLang];
            for(let k in t) { if(document.getElementById(k)) document.getElementById(k).textContent = t[k]; }
        }
        function showView(id) {
            document.querySelectorAll('.section').forEach(el => el.classList.remove('show'));
            document.getElementById(id).classList.add('show');
            if(id==='business-dashboard') updateBalance();
            if(id==='admin-report-view') renderReports();
        }
        function navTo(id) {
            const current = document.querySelector('.section.show');
            if(current && current.id !== 'dashboard-view') viewHistory.push('dashboard-view'); // Simple history
            showView(id);
        }
        function goBack() {
            if(viewHistory.length > 0) showView(viewHistory.pop());
            else showView('dashboard-view');
        }
        function showAlert(msg, type) {
            const m = document.getElementById('custom-modal');
            document.getElementById('modal-title').textContent = type==='error'?'âŒ Error':'âœ… Success';
            document.getElementById('modal-text').textContent = msg;
            m.style.display='flex';
        }
        function closeModal() { document.getElementById('custom-modal').style.display='none'; }

        // --- AUTH ---
        function preSignup() {
            const p = document.getElementById('signup-phone').value;
            const e = document.getElementById('signup-email').value;
            if(!p.match(/^09\d{8}$/)) return showAlert("Phone must start with 09 (10 digits)", "error");
            if(!e.endsWith("@gmail.com")) return showAlert("Email must be @gmail.com", "error");
            document.getElementById('signup-step-1').classList.add('hidden');
            document.getElementById('signup-step-2').classList.remove('hidden');
        }
        function handleSignUp() {
            const n = document.getElementById('signup-name').value;
            const p = document.getElementById('signup-phone').value;
            const e = document.getElementById('signup-email').value;
            const pw = document.getElementById('signup-password').value;
            const f = document.getElementById('signup-profile-photo').files[0];
            
            if(!f) return showAlert("Photo Required", "error");
            
            users.push({name:n, phone:p, email:e, password:pw, balanceUSD:0, balanceGBP:0, balanceEUR:0, balanceETB:0, photo:''});
            localStorage.setItem('fasil_users', JSON.stringify(users));
            showAlert("Registered!", "success"); showView('login-form');
        }
        function handleLogin() {
            const p = document.getElementById('login-phone').value;
            const pw = document.getElementById('login-password').value;
            const u = users.find(user => user.phone === p && user.password === pw);
            if(u) { currentUser=u; if(currentUser.balanceETB===undefined) currentUser.balanceETB=0; localStorage.setItem('fasil_user', JSON.stringify(u)); showView('dashboard-view'); }
            else showAlert("Invalid credentials", "error");
        }
        function handleLogout() { currentUser=null; localStorage.removeItem('fasil_user'); showView('home-view'); }
        function checkAuthAndRedirect(v) { 
            if(!currentUser) return showAlert("Login First", "error");
            pendingAction = () => navTo(v);
            document.getElementById('password-modal').style.display='flex';
        }
        function checkFreeSignupForPremium() { if(!currentUser) { showAlert("Signup First", "error"); showView('signup-form'); } else showView('premium-services-list'); }

        // --- POSTS ---
        function setupPost(type) {
            activePostType = type;
            const form = document.getElementById('post-form-container');
            const fileIn = document.getElementById('post-file-input');
            const contIn = document.getElementById('post-content-input');
            
            form.classList.remove('hidden');
            
            if(type === 'text') {
                document.getElementById('post-instruction').textContent = "Title and Content Required";
                contIn.style.display = 'block';
                fileIn.classList.add('hidden');
            } else {
                document.getElementById('post-instruction').textContent = "Upload File + Title Required (No Details)";
                contIn.style.display = 'none';
                fileIn.classList.remove('hidden');
                fileIn.accept = type + '/*';
                fileIn.click(); // Auto prompt
            }
        }
        function createNewPost() {
            const t = document.getElementById('post-title-input').value;
            const c = document.getElementById('post-content-input').value;
            const f = document.getElementById('post-file-input').files[0];
            
            if(!t) return showAlert("Title is required", "error");
            if(activePostType === 'text' && !c) return showAlert("Content is required", "error");
            if(activePostType !== 'text' && !f) return showAlert("File is required", "error");

            const save=(d)=>{
                posts.unshift({id:Date.now(), title:t, content:activePostType==='text'?c:'', fileData:d, type:activePostType, author:currentUser.name, photo:'', likes:0, follows:0, hidden:false});
                localStorage.setItem('fasil_posts', JSON.stringify(posts));
                showAlert("Success", "success"); 
                displayPosts(activePostType); // Redirect to view
                navTo('view-select');
            };
            if(f) { const r = new FileReader(); r.onload=e=>save(e.target.result); r.readAsDataURL(f); }
            else save(null);
        }
        function displayPosts(type) {
            const c = document.getElementById('posts-container'); c.innerHTML='';
            const fs = posts.filter(p => (p.type === type || (type==='audio' && p.type==='video')) && !p.hidden);
            if(!fs.length) c.innerHTML='<p>Empty</p>';
            fs.forEach(p=>{
                let m = p.fileData ? (p.type==='image'?`<img src="${p.fileData}" width="100%">`: (p.type==='video'?`<video src="${p.fileData}" controls width="100%"></video>`:`<audio src="${p.fileData}" controls></audio>`)) : '';
                c.innerHTML += `<div class="post-card">
                    <div class="user-header"><img src="https://via.placeholder.com/40"> <b>${p.author}</b></div>
                    <h3>${p.title}</h3><p>${p.content}</p>${m}
                    <div class="action-row">
                        <button class="tiny-btn" onclick="likePost(${p.id})"><i class="fas fa-thumbs-up"></i> ${p.likes}</button>
                        <button class="tiny-btn" onclick="sharePost()"><i class="fas fa-share"></i> Share</button>
                        <button class="tiny-btn" onclick="openFeedbackOpts()"><i class="fas fa-comment"></i> View Feedback</button>
                        <button class="tiny-btn" onclick="reportPost(${p.id})"><i class="fas fa-flag"></i> Report</button>
                        <button class="tiny-btn" style="color:red" onclick="deletePost(${p.id}, '${p.author}')"><i class="fas fa-trash"></i> Delete</button>
                    </div>
                </div>`;
            });
            showView('posts-viewer');
        }
        function likePost(id) { const p = posts.find(x=>x.id===id); p.likes++; localStorage.setItem('fasil_posts',JSON.stringify(posts)); displayPosts(p.type); }
        function sharePost() { document.getElementById('share-modal').style.display='flex'; }
        function closeShare() { document.getElementById('share-modal').style.display='none'; }
        function openFeedbackOpts() { document.getElementById('fb-type-modal').style.display='flex'; }
        function viewFeedbackContent(type) { document.getElementById('fb-type-modal').style.display='none'; showAlert("Viewing "+type+" feedbacks...", "success"); }
        function reportPost(id) { const r=prompt("Reason:"); if(r){ reports.push({id, reason:r, reporter:currentUser.name}); localStorage.setItem('fasil_reports',JSON.stringify(reports)); showAlert("Reported", "success"); } }
        function deletePost(id, author) {
            if(author !== currentUser.name) return showAlert("Not your post", "error");
            posts = posts.filter(p=>p.id!==id); localStorage.setItem('fasil_posts',JSON.stringify(posts)); showAlert("Deleted", "success"); displayPosts(activePostType);
        }

        // --- BUSINESS ---
        function updateBalance() {
            document.getElementById('main-usd').textContent=currentUser.balanceUSD.toFixed(2);
            document.getElementById('bal-gbp').textContent=currentUser.balanceGBP.toFixed(2);
            document.getElementById('bal-eur').textContent=currentUser.balanceEUR.toFixed(2);
            document.getElementById('bal-etb').textContent=currentUser.balanceETB.toFixed(2);
            const totalETB = currentUser.balanceETB + (currentUser.balanceUSD * 120);
            document.getElementById('total-est-etb').textContent = totalETB.toFixed(2);
        }
        function preDeposit(){ document.getElementById('dep-step-1').classList.add('hidden'); document.getElementById('dep-step-2').classList.remove('hidden'); }
        function handleDeposit() {
            pendingAction = () => {
                const amt = parseFloat(document.getElementById('deposit-amount').value);
                const cur = document.getElementById('deposit-target-currency').value;
                if(cur==='USD') currentUser.balanceUSD+=amt/RATES.USD;
                else if(cur==='ETB') currentUser.balanceETB+=amt;
                else if(cur==='GBP') currentUser.balanceGBP+=amt/RATES.GBP;
                else currentUser.balanceEUR+=amt/RATES.EUR;
                localStorage.setItem('fasil_user', JSON.stringify(currentUser));
                showAlert("Deposited", "success"); navTo('business-dashboard');
            };
            document.getElementById('password-modal').style.display='flex';
        }
        function toggleReceiverInput() {
            const m=document.getElementById('withdraw-method').value;
            const i=document.getElementById('withdraw-receiver');
            i.style.display='block';
            i.placeholder = m==='PayPal'?'Email (@gmail...)': (m==='CBE'?'1000... (13 Digits)':'Phone 09...');
        }
        function initiateWithdraw() {
            const m=document.getElementById('withdraw-method').value;
            const r=document.getElementById('withdraw-receiver').value;
            if(m==='Telebirr' && !/^09\d{8}$/.test(r)) return showAlert("Telebirr must be 09... (10 digits)", "error");
            if(m==='PayPal' && !r.endsWith('@gmail.com')) return showAlert("PayPal needs Email", "error");
            
            pendingAction = () => {
                showAlert("Success", "success"); navTo('business-dashboard');
            };
            document.getElementById('password-modal').style.display='flex';
        }
        function handleIntlPurchase() {
            pendingAction = () => { showAlert("Purchased", "success"); navTo('business-dashboard'); };
            document.getElementById('password-modal').style.display='flex';
        }
        function confirmActionWithPassword() {
            if(document.getElementById('modal-password-input').value === currentUser.password) {
                document.getElementById('password-modal').style.display='none';
                if(pendingAction) pendingAction();
            } else showAlert("Wrong Password", "error");
        }

        // --- LIVE ---
        function openLiveCamera() {
            showView('live-view');
            if(navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                navigator.mediaDevices.getUserMedia({ video: true }).then(stream => {
                    streamObj = stream;
                    document.getElementById('live-video-element').srcObject = stream;
                });
            }
        }
        function stopLiveCamera() {
            if(streamObj) streamObj.getTracks().forEach(t => t.stop());
            goBack();
        }

        // --- ADMIN ---
        function renderReports() {
            const c=document.getElementById('report-container'); c.innerHTML='';
            reports.forEach(r => {
                const p = posts.find(x=>x.id===r.id);
                c.innerHTML += `<div class="post-card"><b>Post ID:</b> ${r.id}<br><b>Reason:</b> ${r.reason}<br><button class="delete-btn" onclick="banPost(${r.id})">Ban Post</button></div>`;
            });
        }
        function banPost(id) {
            const p = posts.find(x=>x.id===id); if(p) p.hidden=true;
            localStorage.setItem('fasil_posts',JSON.stringify(posts)); showAlert("Banned", "success");
        }

        // --- USER & GROUP ---
        function showUserList(sel) {
            const c=document.getElementById('user-list-container'); c.innerHTML='';
            users.forEach(u=>{
                if(u.phone===currentUser.phone) return;
                c.innerHTML+=`<div class="user-item" onclick="${sel?'this.classList.toggle(\'selected\')':''}"><img src="https://via.placeholder.com/40"> ${u.name}</div>`;
            });
            document.getElementById('user-list-action-btn').style.display = sel?'block':'none';
            navTo('user-list-view');
        }
        function createGroup() {
            const sel = document.querySelectorAll('.selected');
            if(sel.length < 5) return showAlert("Select at least 5", "error");
            showAlert("Group Created", "success"); goBack();
        }
        // Others (Chat, Feedback) use standard flows simplified above.

        // Init
        document.getElementById('loading-overlay')?.style.display='none';
        toggleLanguage();
    </script>
</body>
</html>
