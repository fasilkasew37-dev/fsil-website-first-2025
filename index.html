ለ<!DOCTYPE html>
<html lang="am">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ፋሲል ዌብ አፕ - Fasil Web App (Firebase Version)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

    <style>
        /* CSS እዚህ ይቀጥላል (አንተ ከሰጠኸው ጋር አንድ አይነት ነው) */
        body { font-family: 'Segoe UI', sans-serif; text-align: center; padding: 0; margin: 0; background-color: #f0f4f8; padding-bottom: 90px; }
        .container { max-width: 700px; margin: 0 auto; padding: 5px; }
        .top-header { display: flex; justify-content: space-between; align-items: center; background: #fff; padding: 5px 10px; border-bottom: 3px solid #007bff; }
        .header-icon-img { width: 45px; height: 45px; border-radius: 50%; object-fit: cover; }
        .section { display: none; background: white; padding: 15px; border-radius: 8px; margin-top: 10px; min-height: 400px; }
        .show { display: block; }
        .btn-green { background: #28a745; color: white; border: none; padding: 10px; cursor: pointer; border-radius: 5px; }
        .btn-blue { background: #007bff; color: white; border: none; padding: 10px; cursor: pointer; border-radius: 5px; }
        .btn-red { background: #dc3545; color: white; border: none; padding: 10px; cursor: pointer; border-radius: 5px; }
        input, textarea { width: 100%; padding: 10px; margin: 5px 0; box-sizing: border-box; }
        .post-card { border: 1px solid #eee; padding: 10px; margin-bottom: 10px; text-align: left; border-radius: 8px; }
        .footer-wrapper { position: fixed; bottom: 0; width: 100%; background: white; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); }
        .bottom-nav { display: flex; height: 55px; }
        .nav-btn { flex: 1; border: none; cursor: pointer; color: white; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="top-header">
    <img src="https://via.placeholder.com/50" class="header-icon-img" alt="Eagle">
    <div id="status-msg" style="color: #007bff; font-weight: bold;">እንኳን ደህና መጡ!</div>
    <img src="https://via.placeholder.com/50" class="header-icon-img" alt="Lion">
</div>

<div class="container">
    <div id="view-agreement" class="section show">
        <h3>ውል እና ስምምነት</h3>
        <p>ፖለቲካ፣ ጥላቻ እና ዘረኝነት በጥብቅ የተከለከለ ነው።</p>
        <button class="btn-green" onclick="showAuth()">እስማማለሁ</button>
    </div>

    <div id="view-auth" class="section">
        <h3 id="auth-title">መግቢያ</h3>
        <input type="email" id="auth-email" placeholder="Email (@gmail.com)">
        <input type="password" id="auth-pass" placeholder="Password (min 6 chars)">
        <div id="signup-only" class="hidden">
            <input type="text" id="auth-name" placeholder="Full Name">
            <input type="text" id="auth-phone" placeholder="Phone Number">
        </div>
        <button class="btn-blue" id="main-auth-btn" onclick="handleAuth()">መግቢያ</button>
        <p onclick="toggleAuthMode()" id="auth-toggle" style="color: blue; cursor: pointer;">አዲስ ተጠቃሚ? ይመዝገቡ</p>
    </div>

    <div id="view-home" class="section">
        <h2>ዳሽቦርድ</h2>
        <button class="btn-green" onclick="navTo('view-post')">መረጃ መለጠፍ</button>
        <button class="btn-blue" onclick="navTo('view-feed'); loadPosts();">መረጃ መመልከት</button>
        <button class="btn-red" onclick="logout()">ውጣ</button>
    </div>

    <div id="view-post" class="section">
        <h3>መረጃ መለጠፍ</h3>
        <input type="text" id="post-title" placeholder="ርዕስ">
        <textarea id="post-content" placeholder="ዝርዝር መረጃ..."></textarea>
        <input type="file" id="post-file" accept="image/*,video/*">
        <button class="btn-green" onclick="uploadPost()">አሁኑኑ ልጠፍ</button>
        <button class="btn-red" onclick="navTo('view-home')">ተመለስ</button>
    </div>

    <div id="view-feed" class="section">
        <h3>የመረጃ ማዕከል</h3>
        <div id="feed-container"></div>
        <button class="btn-red" onclick="navTo('view-home')">ተመለስ</button>
    </div>
</div>

<div class="footer-wrapper">
    <div class="bottom-nav">
        <button class="nav-btn" style="background:#28a745" onclick="navTo('view-home')"><i class="fas fa-home"></i> Home</button>
        <button class="nav-btn" style="background:#dc3545" onclick="logout()"><i class="fas fa-user"></i> Logout</button>
    </div>
</div>

<script>
    // --- 1. FIREBASE CONFIG (ይህንን በራስህ መረጃ ተካው) ---
    const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "YOUR_PROJECT.firebaseapp.com",
        projectId: "YOUR_PROJECT_ID",
        storageBucket: "YOUR_PROJECT.appspot.com",
        messagingSenderId: "YOUR_SENDER_ID",
        appId: "YOUR_APP_ID"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();

    let isSignup = false;

    // --- 2. AUTH LOGIC ---
    function toggleAuthMode() {
        isSignup = !isSignup;
        document.getElementById('signup-only').classList.toggle('hidden');
        document.getElementById('auth-title').innerText = isSignup ? "ምዝገባ" : "መግቢያ";
        document.getElementById('main-auth-btn').innerText = isSignup ? "ተመዝገብ" : "መግቢያ";
        document.getElementById('auth-toggle').innerText = isSignup ? "ነባር ተጠቃሚ? ይግቡ" : "አዲስ ተጠቃሚ? ይመዝገቡ";
    }

    async function handleAuth() {
        const email = document.getElementById('auth-email').value;
        const pass = document.getElementById('auth-pass').value;

        try {
            if (isSignup) {
                const name = document.getElementById('auth-name').value;
                const phone = document.getElementById('auth-phone').value;
                const res = await auth.createUserWithEmailAndPassword(email, pass);
                await db.collection('users').doc(res.user.uid).set({
                    name, phone, email, uid: res.user.uid, createdAt: new Date()
                });
                alert("ምዝገባ ተሳክቷል!");
            } else {
                await auth.signInWithEmailAndPassword(email, pass);
            }
            navTo('view-home');
        } catch (e) { alert(e.message); }
    }

    function logout() {
        auth.signOut();
        navTo('view-auth');
    }

    // --- 3. POSTING LOGIC (With Storage) ---
    async function uploadPost() {
        const user = auth.currentUser;
        if (!user) return alert("መጀመሪያ ይግቡ");

        const title = document.getElementById('post-title').value;
        const content = document.getElementById('post-content').value;
        const file = document.getElementById('post-file').files[0];
        let fileUrl = "";

        if (!title) return alert("ርዕስ ያስገቡ");

        try {
            if (file) {
                const ref = storage.ref(`posts/${Date.now()}_${file.name}`);
                await ref.put(file);
                fileUrl = await ref.getDownloadURL();
            }

            await db.collection('posts').add({
                title, content, fileUrl,
                authorId: user.uid,
                authorEmail: user.email,
                type: file ? (file.type.includes('video') ? 'video' : 'image') : 'text',
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            });

            alert("መረጃው ተለጥፏል!");
            navTo('view-home');
        } catch (e) { alert(e.message); }
    }

    // --- 4. VIEW LOGIC ---
    function loadPosts() {
        const container = document.getElementById('feed-container');
        container.innerHTML = "በመጫን ላይ...";

        db.collection('posts').orderBy('createdAt', 'desc').onSnapshot(snap => {
            container.innerHTML = "";
            snap.forEach(doc => {
                const p = doc.data();
                const card = document.createElement('div');
                card.className = 'post-card';
                card.innerHTML = `
                    <h4>${p.title}</h4>
                    <p>${p.content}</p>
                    ${p.fileUrl ? (p.type === 'video' ? `<video src="${p.fileUrl}" controls width="100%"></video>` : `<img src="${p.fileUrl}" width="100%">`) : ''}
                    <small>በ: ${p.authorEmail}</small>
                `;
                container.appendChild(card);
            });
        });
    }

    // --- 5. NAVIGATION ---
    function navTo(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('show'));
        document.getElementById(id).classList.add('show');
    }

    function showAuth() { navTo('view-auth'); }

    // Check auth state
    auth.onAuthStateChanged(user => {
        if (user) navTo('view-home');
        else navTo('view-auth');
    });
</script>
</body>
</html>
