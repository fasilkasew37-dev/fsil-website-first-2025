ረ<!DOCTYPE html>
<html lang="am">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fasil Web App - Service Center</title>
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        :root { --primary: #007bff; --secondary: #6c757d; --success: #28a745; --danger: #dc3545; --warning: #ffc107; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 0; background: #f4f4f4; overflow-x: hidden; }
        
        /* Splash Screen */
        #splash-screen { position: fixed; top:0; left:0; width:100%; height:100%; background: #0056b3; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 9999; color: white; transition: opacity 0.5s; }
        .brand-area { display: flex; align-items: center; gap: 10px; }
        .complex-logo { position: relative; width: 80px; height: 80px; }
        .ring { border-radius: 50%; border: 4px solid transparent; position: absolute; top:0; left:0; right:0; bottom:0; }
        .ring-blue { border-top-color: blue; animation: spin 2s linear infinite; }
        .center-lion { width: 50px; height: 50px; border-radius: 50%; position: absolute; top: 15px; left: 15px; }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* General UI */
        .container { max-width: 500px; margin: auto; padding: 20px; min-height: 80vh; background: white; margin-bottom: 70px; }
        .section { display: none; }
        .section.show { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .top-header { background: white; padding: 10px; border-bottom: 2px solid #ddd; display: flex; align-items: center; justify-content: space-between; position: sticky; top:0; z-index: 100; }
        .marquee-container-top { flex: 1; overflow: hidden; white-space: nowrap; margin: 0 10px; }
        .marquee-text-top { display: inline-block; animation: scroll 15s linear infinite; font-weight: bold; color: #d32f2f; }
        @keyframes scroll { from { transform: translateX(100%); } to { transform: translateX(-100%); } }

        /* Buttons */
        .btn-green { background: var(--success); color: white; border: none; padding: 10px; cursor: pointer; border-radius: 5px; width: 100%; margin: 5px 0; }
        .btn-red { background: var(--danger); color: white; border: none; padding: 10px; cursor: pointer; border-radius: 5px; width: 100%; }
        .btn-blue { background: var(--primary); color: white; border: none; padding: 10px; cursor: pointer; border-radius: 5px; width: 100%; }
        .btn-yellow { background: var(--warning); color: black; border: none; padding: 10px; cursor: pointer; border-radius: 5px; width: 100%; }
        .btn-small { width: auto; padding: 5px 15px; font-size: 14px; }

        /* Grid for Dashboard */
        .service-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        
        /* Modal */
        .modal-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.7); display: none; align-items: center; justify-content: center; z-index: 1000; }
        .modal-box { background: white; padding: 20px; border-radius: 10px; width: 80%; max-width: 400px; text-align: center; }

        /* Chat & Feed */
        #chat-box, #feed-container, #fb-list { border: 1px solid #ddd; height: 300px; overflow-y: auto; padding: 10px; margin-bottom: 10px; background: #fafafa; border-radius: 5px; }
        .post-card { background: white; border: 1px solid #eee; padding: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .user-item { padding: 10px; border-bottom: 1px solid #eee; cursor: pointer; }
        .bright-blue { background: #d1e7ff !important; }

        /* Bottom Nav */
        .footer-wrapper { position: fixed; bottom: 0; width: 100%; max-width: 500px; left: 50%; transform: translateX(-50%); background: white; border-top: 1px solid #ddd; }
        .bottom-nav { display: flex; justify-content: space-around; padding: 10px 0; }
        .nav-btn { background: none; border: none; font-size: 12px; color: #555; cursor: pointer; display: flex; flex-direction: column; align-items: center; }
        .nav-btn i { font-size: 20px; margin-bottom: 2px; }
        .bottom-marquee { background: #333; color: white; font-size: 10px; text-align: center; padding: 2px; }
        
        .hidden-input { display: none; }
    </style>
</head>
<body>

<!-- 1. SPLASH SCREEN -->
<div id="splash-screen">
    <div class="brand-area" style="transform: scale(1.5);">
        <div class="complex-logo">
            <div class="ring ring-blue"></div>
            <img src="https://via.placeholder.com/50/FF0000/FFFFFF?text=L" class="center-lion">
        </div>
    </div>
    <div id="splash-msg" style="margin-top:20px; font-weight: bold;">Loading...</div>
</div>

<!-- Header -->
<div class="top-header">
    <div class="brand-area" style="transform: scale(0.5);">
        <div class="complex-logo"><div class="ring ring-blue"></div><img src="https://via.placeholder.com/50/FF0000/FFFFFF?text=L" class="center-lion"></div>
    </div>
    <div class="marquee-container-top"><span class="marquee-text-top" id="head-txt">እንኳን ወደ ፋሲል ዌብ አፕ የአገልግሎት ማዕከል በደህና መጡ!</span></div>
    <button class="btn-small btn-blue" onclick="toggleLanguage()" id="lang-btn-txt">English</button>
</div>

<div class="container">
    <!-- MODALS -->
    <div class="modal-overlay" id="admin-login-modal">
        <div class="modal-box">
            <h3>Admin Login</h3>
            <input type="password" id="admin-pass-in" placeholder="Code" style="width:90%; padding:10px; margin-bottom:10px;">
            <button class="btn-green" onclick="adminLogin()">Enter</button>
            <button class="btn-red" onclick="closeModal('admin-login-modal')">Cancel</button>
        </div>
    </div>

    <!-- 1. VIEW: AGREEMENT / AUTH -->
    <div id="view-agreement" class="section show">
        <div class="split-container" id="welcome-content">
            <h4 id="t-w-s">እንኳን ደህና መጡ</h4>
            <p id="t-in">ይህ የፋሲል ዌብ አፕ በተአማኒነት እንዲሰራ የተቀየሰ ዲጂታል መረጃ መጋሪያ ነው።</p>
            <h4 id="t-p-s">ጥብቅ መመሪያ</h4>
            <p id="t-po">ፖለቲካ፣ ጥላቻ እና ሀሰተኛ መረጃ ማቅረብ በጥብቅ የተከለከለ ነው።</p>
            <div style="display: flex; gap: 10px; justify-content: center;">
                <button class="btn-green btn-small" onclick="handleAgree()">እስማማለሁ</button>
                <button class="btn-red btn-small" onclick="alert('ይቅርታ፣ መቀጠል የሚችሉት ሲስማሙ ብቻ ነው።')">አልስማማም</button>
            </div>
        </div>
        
        <div id="auth-section" style="display:none;">
            <p style="color: green; font-weight: bold; text-align: center;">አገልግሎታችንን ስለመረጡ እናመሰግናለን!</p>
            <div style="display:flex; gap:10px;">
                <button class="btn-red" onclick="showAuth('signup')">መመዝገቢያ</button>
                <button class="btn-blue" onclick="showAuth('login')">መግቢያ</button>
            </div>
            
            <div id="form-signup" style="display:none; margin-top:20px; border: 1px solid #ddd; padding: 15px; border-radius: 10px;">
                <div id="signup-step-1">
                    <h3 id="h-s">ምዝገባ</h3>
                    <input type="text" id="reg-name" placeholder="Full Name" style="width:90%; padding:8px; margin-bottom:5px;">
                    <input type="text" id="reg-phone" placeholder="Phone (09...)" style="width:90%; padding:8px; margin-bottom:5px;">
                    <input type="password" id="reg-pass" placeholder="Password" style="width:90%; padding:8px; margin-bottom:5px;">
                    <button class="btn-green" onclick="preSignup()">ቀጥል</button>
                </div>
                <div id="signup-step-2" style="display:none; text-align: center;">
                    <h3>ፎቶ ይጫኑ</h3>
                    <button class="btn-blue" onclick="document.getElementById('universal-file').click()">ፎቶ ምረጥ</button>
                    <button class="btn-green" onclick="finalSignup()">ጨርስ</button>
                </div>
            </div>

            <div id="form-login" style="display:none; margin-top:20px; border: 1px solid #ddd; padding: 15px; border-radius: 10px;">
                <h3 id="h-l">መግቢያ</h3>
                <input type="text" id="log-phone" placeholder="Phone" style="width:90%; padding:8px; margin-bottom:5px;">
                <input type="password" id="log-pass" placeholder="Password" style="width:90%; padding:8px; margin-bottom:5px;">
                <button class="btn-blue" onclick="doLogin()">ግባ</button>
            </div>
        </div>
    </div>

    <!-- 2. DASHBOARD -->
    <div id="view-home" class="section">
        <h2>ዳሽቦርድ</h2>
        <button class="btn-green" onclick="toggleList('free')">የነፃ አገልግሎት ማዕከል</button>
        <div id="list-free" style="display:none; padding:10px; border:1px solid #eee;">
            <div class="service-grid">
                <button class="btn-green btn-small" onclick="navTo('view-info')">መረጃ መመልከት</button>
                <button class="btn-green btn-small" onclick="navTo('post-info')">መረጃ መለጠፍ</button>
                <button class="btn-green btn-small" onclick="handleGroupCreate()">ግሩፕ መፍጠር</button>
                <button class="btn-green btn-small" onclick="showMyGroups()">የፈጠሩትን ግሩፕ</button>
                <button class="btn-green btn-small" onclick="handleChatList()">ቻት</button>
                <button class="btn-green btn-small" onclick="navTo('feedback-sec')">አስተያየት</button>
                <button class="btn-green btn-small" onclick="showUserList(false)">ተጠቃሚዎች</button>
                <button class="btn-green btn-small" onclick="navTo('business-sec')">ቢዝነስ</button>
            </div>
            <button class="btn-green btn-small" style="background:#333; width:100%; margin-top:10px;" onclick="openAdmin()">ሪፖርት (Admin)</button>
        </div>

        <button class="btn-yellow" style="margin-top:10px;" onclick="toggleList('prem')">የክፍያ ፕሪሚየም አገልግሎት</button>
        <div id="list-prem" style="display:none; padding:10px; border:1px solid #eee;">
            <div class="service-grid">
                <button class="btn-yellow btn-small" onclick="alert('ፕሪሚየም ያስፈልጋል')">Premium Video</button>
                <button class="btn-yellow btn-small" onclick="alert('ፕሪሚየም ያስፈልጋል')">PowerPoint</button>
                <button class="btn-yellow btn-small" onclick="alert('ፕሪሚየም ያስፈልጋል')">PDF</button>
            </div>
        </div>
        <button class="btn-red" style="margin-top:20px;" onclick="doLogout()">ውጣ</button>
    </div>

    <!-- 3. POST & VIEW -->
    <div id="post-info" class="section">
        <h3>መረጃ መለጠፍ</h3>
        <div id="post-type-select">
            <button class="btn-blue" onclick="setupPost('text')">Text</button>
            <button class="btn-blue" onclick="setupPost('image')">Image</button>
        </div>
        <div id="post-form-area" style="display:none; margin-top:10px;">
            <input type="text" id="p-title" placeholder="ርዕስ" style="width:90%; padding:8px; margin-bottom:5px;">
            <textarea id="p-content" placeholder="ዝርዝር መረጃ..." style="width:90%; height:100px; padding:8px;"></textarea>
            <button class="btn-green" onclick="submitPost()">አሁን ልጥፍ</button>
        </div>
        <button class="btn-red btn-small" onclick="goBack()" style="margin-top:10px;">ተመለስ</button>
    </div>
    
    <div id="view-info" class="section">
        <h3>መረጃ መመልከት</h3>
        <div style="display:flex; gap:5px; margin-bottom:10px;">
            <button class="btn-blue btn-small" onclick="renderPosts('text')">ጽሁፍ</button>
            <button class="btn-blue btn-small" onclick="renderPosts('image')">ምስል</button>
        </div>
        <div id="feed-container">Loading...</div>
        <button class="btn-red btn-small" onclick="goBack()">ተመለስ</button>
    </div>

    <!-- CHAT SECTION -->
    <div id="chat-sec" class="section">
        <h3>ቻት</h3>
        <div id="chat-box"></div>
        <div style="display:flex; gap:5px;">
            <input type="text" id="chat-in" placeholder="መልእክት..." style="flex:1; padding:8px;">
            <button class="btn-blue btn-small" onclick="sendChat()">ላክ</button>
        </div>
        <button class="btn-red btn-small" onclick="goBack()" style="margin-top:10px;">ተመለስ</button>
    </div>

    <!-- GROUPS -->
    <div id="user-list-sec" class="section">
        <h3>ተጠቃሚዎች</h3>
        <div id="ul-cont"></div>
        <button class="btn-green" id="btn-grp-done" style="display:none; margin-top:10px;" onclick="createGroup()">ግሩፕ ፍጠር</button>
        <button class="btn-red btn-small" onclick="goBack()">ተመለስ</button>
    </div>
    <div id="my-groups-sec" class="section">
        <h3>የኔ ግሩፖች</h3>
        <div id="grp-list"></div>
        <button class="btn-red btn-small" onclick="goBack()">ተመለስ</button>
    </div>

    <!-- FEEDBACK -->
    <div id="feedback-sec" class="section">
        <h3>አስተያየት</h3>
        <button class="btn-blue" onclick="giveFb()">አስተያየት ስጥ</button>
        <div id="fb-list" style="margin-top:10px;"></div>
        <button class="btn-red btn-small" onclick="goBack()">ተመለስ</button>
    </div>

    <!-- BUSINESS -->
    <div id="business-sec" class="section">
        <h3>ቢዝነስ ማዕከል</h3>
        <p>ቀሪ ሂሳብ: 0.00 ETB</p>
        <button class="btn-green" onclick="alert('በቅርብ ቀን...')">ገንዘብ አስገባ (Deposit)</button>
        <button class="btn-red btn-small" onclick="goBack()" style="margin-top:10px;">ተመለስ</button>
    </div>

    <!-- ADMIN PANEL -->
    <div id="report-inbox" class="section">
        <h3>Admin Inbox (Reports)</h3>
        <div id="admin-dynamic-content"></div>
        <button class="btn-red btn-small" onclick="goBack()">ተመለስ</button>
    </div>
</div>

<input type="file" id="universal-file" class="hidden-input">

<div class="footer-wrapper">
    <div class="bottom-nav">
        <button class="nav-btn" onclick="navTab('home')"><i class="fas fa-home"></i><span>Home</span></button>
        <button class="nav-btn" onclick="alert('Live በቅርብ ቀን...')"><i class="fas fa-broadcast-tower"></i><span>Live</span></button>
        <button class="nav-btn" onclick="alert('Profile info...')"><i class="fas fa-user"></i><span>Profile</span></button>
    </div>
    <div class="bottom-marquee">ፋሲል ዌับ አፕ - Fasil Web App (Service Center)</div>
</div>

<script>
    // --- FIREBASE CONFIG ---
    const firebaseConfig = {
      apiKey: "AIzaSyAWS8PJ0kmu56hixesxV1KrMH8NRciH6U0",
      authDomain: "fasil-web-app-3a732.firebaseapp.com",
      projectId: "fasil-web-app-3a732",
      storageBucket: "fasil-web-app-3a732.firebasestorage.app",
      messagingSenderId: "239133072986",
      appId: "1:239133072986:web:0dcbd768e1e916b9b64263"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // --- APP STATE ---
    let user = null;
    let users = [];
    let posts = [];
    let lang = 'am';
    let selectedGroupUsers = [];

    // --- STARTUP ---
    window.onload = () => {
        setTimeout(() => {
            document.getElementById('splash-screen').style.opacity = '0';
            setTimeout(() => document.getElementById('splash-screen').style.display = 'none', 500);
        }, 2000);
        loadUsers();
        loadPosts();
    };

    // --- REALTIME LISTENERS ---
    function loadUsers() {
        db.collection("users").onSnapshot(s => {
            users = [];
            s.forEach(d => users.push({ id: d.id, ...d.data() }));
        });
    }

    function loadPosts() {
        db.collection("posts").orderBy("id", "desc").onSnapshot(s => {
            posts = [];
            s.forEach(d => posts.push(d.data()));
            if (document.getElementById('view-info').classList.contains('show')) renderPosts('text');
        });
    }

    // --- NAVIGATION ---
    function showView(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('show'));
        document.getElementById(id).classList.add('show');
    }
    function navTo(id) { showView(id); }
    function goBack() { user ? showView('view-home') : showView('view-agreement'); }
    function navTab(t) { if(user) showView('view-home'); else alert("እባክዎ መጀመሪያ ይግቡ!"); }

    // --- AUTH ---
    function handleAgree() {
        document.getElementById('welcome-content').style.display = 'none';
        document.getElementById('auth-section').style.display = 'block';
    }
    function showAuth(t) {
        document.getElementById('form-signup').style.display = (t === 'signup' ? 'block' : 'none');
        document.getElementById('form-login').style.display = (t === 'login' ? 'block' : 'none');
    }
    function preSignup() {
        const p = document.getElementById('reg-phone').value;
        if(!p) return alert("ቁጥር ያስገቡ");
        document.getElementById('signup-step-1').style.display = 'none';
        document.getElementById('signup-step-2').style.display = 'block';
    }
    function finalSignup() {
        const n = document.getElementById('reg-name').value;
        const p = document.getElementById('reg-phone').value;
        const pw = document.getElementById('reg-pass').value;
        db.collection("users").add({ name: n, phone: p, password: pw }).then(() => {
            alert("ተመዝግበዋል! አሁን ይግቡ።");
            showAuth('login');
        });
    }
    function doLogin() {
        const p = document.getElementById('log-phone').value;
        const pw = document.getElementById('log-pass').value;
        db.collection("users").where("phone", "==", p).where("password", "==", pw).get().then(s => {
            if (!s.empty) {
                user = s.docs[0].data();
                user.id = s.docs[0].id;
                showView('view-home');
            } else alert("የተሳሳተ መረጃ!");
        });
    }
    function doLogout() { user = null; location.reload(); }

    // --- DASHBOARD ---
    function toggleList(t) {
        const l = document.getElementById('list-' + t);
        l.style.display = l.style.display === 'none' ? 'block' : 'none';
    }

    // --- POSTS ---
    function setupPost(t) {
        document.getElementById('post-form-area').style.display = 'block';
        document.getElementById('p-content').style.display = (t==='text'?'block':'none');
    }
    function submitPost() {
        const t = document.getElementById('p-title').value;
        const c = document.getElementById('p-content').value;
        db.collection("posts").add({ id: Date.now(), t, c, u: user.name, type: 'text' })
        .then(() => { alert("ተለጥፏል!"); navTo('view-info'); });
    }
    function renderPosts(type) {
        const cont = document.getElementById('feed-container');
        cont.innerHTML = posts.map(p => `<div class="post-card"><b>${p.t}</b><br>${p.c}<br><small>በ: ${p.u}</small></div>`).join('');
    }

    // --- CHAT ---
    function handleChatList() {
        navTo('chat-sec');
        db.collection("chats").orderBy("time", "asc").onSnapshot(s => {
            const box = document.getElementById('chat-box');
            box.innerHTML = "";
            s.forEach(d => {
                const m = d.data();
                box.innerHTML += `<div style="margin-bottom:5px;"><b>${m.u}:</b> ${m.m}</div>`;
            });
            box.scrollTop = box.scrollHeight;
        });
    }
    function sendChat() {
        const m = document.getElementById('chat-in').value;
        if(!m) return;
        db.collection("chats").add({ u: user.name, m: m, time: Date.now() });
        document.getElementById('chat-in').value = "";
    }

    // --- GROUPS ---
    function handleGroupCreate() {
        selectedGroupUsers = [];
        showUserList(true);
    }
    function showUserList(isSel) {
        const cont = document.getElementById('ul-cont');
        cont.innerHTML = users.map(u => `<div class="user-item" id="u-${u.id}" onclick="selectUser('${u.id}', ${isSel})">${u.name}</div>`).join('');
        document.getElementById('btn-grp-done').style.display = isSel ? 'block' : 'none';
        navTo('user-list-sec');
    }
    function selectUser(id, isSel) {
        if(!isSel) return;
        const el = document.getElementById('u-'+id);
        if(selectedGroupUsers.includes(id)) {
            selectedGroupUsers = selectedGroupUsers.filter(i => i !== id);
            el.classList.remove('bright-blue');
        } else {
            selectedGroupUsers.push(id);
            el.classList.add('bright-blue');
        }
    }
    function createGroup() {
        const gName = prompt("የግሩፕ ስም ያስገቡ:");
        if(!gName) return;
        db.collection("groups").add({ name: gName, members: selectedGroupUsers, creator: user.phone });
        alert("ግሩፕ ተፈጥሯል!");
        goBack();
    }
    function showMyGroups() {
        navTo('my-groups-sec');
        db.collection("groups").get().then(s => {
            document.getElementById('grp-list').innerHTML = s.docs.map(d => `<div class="post-card">${d.data().name}</div>`).join('');
        });
    }

    // --- FEEDBACK ---
    function giveFb() {
        const m = prompt("አስተያየትዎን ያስገቡ:");
        if(m) db.collection("feedback").add({ u: user.name, m: m, time: Date.now() }).then(() => alert("አመሰግናለን!"));
    }

    // --- ADMIN ---
    function openAdmin() { document.getElementById('admin-login-modal').style.display = 'flex'; }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }
    function adminLogin() {
        if(document.getElementById('admin-pass-in').value === "admin123") {
            closeModal('admin-login-modal');
            navTo('report-inbox');
            db.collection("feedback").get().then(s => {
                document.getElementById('admin-dynamic-content').innerHTML = s.docs.map(d => `<p>${d.data().u}: ${d.data().m}</p>`).join('');
            });
        } else alert("የተሳሳተ ኮድ!");
    }

    // --- LANGUAGE ---
    function toggleLanguage() {
        lang = (lang === 'am' ? 'en' : 'am');
        document.getElementById('lang-btn-txt').innerText = (lang === 'am' ? 'English' : 'አማርኛ');
        // እዚህ ጋር ሁሉንም ጽሁፎች መቀየር ይቻላል
    }
</script>
</body>
</html>
